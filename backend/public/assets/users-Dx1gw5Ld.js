import{j as e,W as ie,A as ce,B as f,X as m,Y as K,d as I,Z,N as _,n as de,b as he,R as Q,_ as N,$ as Y,V as B,I as y,a0 as J,a1 as ee,r as h,a2 as ue,a3 as xe,a4 as me,Q as pe,a5 as $,a6 as je,G as P,w as O,p as L,k as E,T as g,x as ge,U as fe,y as be,a7 as ve,e as Ce}from"./index-FMbyiGBg.js";import{F as ye,a as z,c as G}from"./filters-result-3uqTrs08.js";import{u as we,a as Te,o as Se,F as De,b as v,s as C}from"./form-provider-WaecDOme.js";import{t as A}from"./index-Dm2dmlBn.js";import{D as ke,a as Re,b as Ae}from"./DialogTitle-BM4PjASd.js";import{C as se,a as te,u as Ee,g as Ue,r as Ie,T as Fe,b as Pe,c as Le,e as Ne,d as Be,f as Me}from"./table-pagination-custom-CV1VRxF6.js";import{C as $e}from"./custom-breadcrumbs-BYE_vmd6.js";import{T as Oe,a as k,b as ze,c as Ge}from"./TableHead-CZEiNHrS.js";import{S as _e}from"./Stack-C1li3Gzt.js";import{T as Qe}from"./TextField-qof22fmD.js";import{G as U}from"./Grid-D0Xua7tw.js";import"./TableSortLabel-z7RTXk9i.js";const Ve=Se({name:C().min(1,{message:"Name is required!"}),email:C().min(1,{message:"Email is required!"}).email({message:"Email must be a valid email address!"}),phoneNumber:C().optional(),country:C().optional(),state:C().optional(),city:C().optional(),address:C().optional(),zipCode:C().optional(),company:C().optional(),role:C().optional(),status:C().optional()});function We({currentUser:s,open:o,onClose:n}){const c={name:"",email:"",phoneNumber:"",address:"",country:"",state:"",city:"",zipCode:"",status:"",company:"",role:""},a=we({mode:"all",resolver:Te(Ve),defaultValues:c,values:s}),{reset:i,handleSubmit:d,formState:{isSubmitting:p}}=a,l=d(async r=>{const u=new Promise(j=>setTimeout(j,1e3));try{i(),n(),A.promise(u,{loading:"Loading...",success:"Update success!",error:"Update error!"}),await u,console.info("DATA",r)}catch(j){console.error(j)}});return e.jsx(ie,{fullWidth:!0,maxWidth:!1,open:o,onClose:n,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{maxWidth:720}},children:e.jsxs(De,{methods:a,onSubmit:l,children:[e.jsx(ke,{children:"Quick Update"}),e.jsxs(Re,{dividers:!0,sx:{pt:3},children:[e.jsx(ce,{severity:"info",sx:{mb:3},children:"Update the information below and we will update you when changes are made."}),e.jsxs(f,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[e.jsx(v.Text,{name:"name",label:"Full Name"}),e.jsx(v.Text,{name:"email",label:"Email Address"}),e.jsx(v.Text,{name:"phoneNumber",label:"Phone Number"}),e.jsx(v.Text,{name:"address",label:"Address"}),e.jsx(v.Text,{name:"country",label:"Country"}),e.jsx(v.Text,{name:"state",label:"State/Region"}),e.jsx(v.Text,{name:"city",label:"City"}),e.jsx(v.Text,{name:"zipCode",label:"Zip/Code"}),e.jsx(v.Text,{name:"company",label:"Company"}),e.jsxs(v.Select,{name:"role",label:"Role",children:[e.jsx(m,{value:"leader",children:" Leader "}),e.jsx(m,{value:"hr",children:" HR "}),e.jsx(m,{value:"ui designer",children:" UI Designer "}),e.jsx(m,{value:"ux designer",children:" UX Designer "}),e.jsx(m,{value:"ui/ux designer",children:" UI/UX Designer "}),e.jsx(m,{value:"project manager",children:" Project Manager "}),e.jsx(m,{value:"backend developer",children:" Backend Developer "}),e.jsx(m,{value:"full stack designer",children:" Full Stack Designer "}),e.jsx(m,{value:"front end developer",children:" Front End Developer "}),e.jsx(m,{value:"full stack developer",children:" Full Stack Developer "})]}),e.jsx(v.Select,{name:"status",label:"Status",children:K.map(r=>e.jsx(m,{value:r.value,children:r.label},r.value))})]})]}),e.jsxs(Ae,{children:[e.jsx(I,{variant:"outlined",color:"inherit",onClick:n,children:"Cancel"}),e.jsx(I,{type:"submit",variant:"contained",disabled:p,children:"Update"})]})]})})}function He({row:s,userRoles:o,selected:n,editHref:c,onSelectRow:a,onDeleteRow:i}){const d=Z(),p=_(),l=_(),r=()=>e.jsx(We,{currentUser:s,open:l.value,onClose:l.onFalse}),u=()=>e.jsx(J,{open:d.open,anchorEl:d.anchorEl,onClose:d.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(ee,{children:[e.jsx("li",{children:e.jsxs(m,{component:Q,href:c,onClick:()=>d.onClose(),children:[e.jsx(y,{icon:"solar:pen-bold"}),"Edit"]})}),e.jsxs(m,{onClick:()=>{p.onTrue(),d.onClose()},sx:{color:"error.main"},children:[e.jsx(y,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})}),j=()=>e.jsx(te,{open:p.value,onClose:p.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(I,{variant:"contained",color:"error",onClick:i,children:"Delete"})});return e.jsxs(e.Fragment,{children:[e.jsxs(Oe,{hover:!0,selected:n,"aria-checked":n,tabIndex:-1,children:[e.jsx(k,{padding:"checkbox",children:e.jsx(se,{checked:n,onClick:a,slotProps:{input:{id:`${s.UID}-checkbox`,"aria-label":`${s.UID} checkbox`}}})}),e.jsx(k,{children:e.jsxs(f,{sx:{gap:2,display:"flex",alignItems:"center"},children:[e.jsx(de,{alt:`${s.FIRSTNAME} ${s.LASTNAME}`}),e.jsxs(_e,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsxs(he,{component:Q,href:c,color:"inherit",sx:{cursor:"pointer"},children:[s.FIRSTNAME," ",s.LASTNAME]}),e.jsxs(f,{component:"span",sx:{color:"text.disabled"},children:["ID: ",s.UID]})]})]})}),e.jsx(k,{sx:{whiteSpace:"nowrap"},children:s.EMAIL}),e.jsx(k,{sx:{whiteSpace:"nowrap"},children:s.PHONENUMBER||"N/A"}),e.jsx(k,{sx:{whiteSpace:"nowrap"},children:o.length>0?e.jsx(f,{sx:{display:"flex",flexDirection:"column",gap:.5},children:o.map(w=>e.jsx(N,{variant:"soft",color:w.ROLENAME==="admin"?"primary":"default",sx:{fontSize:"0.75rem"},children:w.ROLENAME},w.ROLEID))}):e.jsx(N,{variant:"soft",color:"default",sx:{fontSize:"0.75rem"},children:"No roles"})}),e.jsx(k,{children:e.jsx(N,{variant:"soft",color:"success",children:"Active"})}),e.jsx(k,{children:e.jsxs(f,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Y,{title:"Quick edit",placement:"top",arrow:!0,children:e.jsx(B,{color:l.value?"inherit":"default",onClick:l.onTrue,children:e.jsx(y,{icon:"solar:pen-bold"})})}),e.jsx(B,{color:d.open?"inherit":"default",onClick:d.onOpen,children:e.jsx(y,{icon:"eva:more-vertical-fill"})})]})})]}),r(),u(),j()]})}function qe({filters:s,options:o,onResetPage:n}){const c=Z(),{state:a,setState:i}=s,d=h.useCallback(r=>{n(),i({name:r.target.value})},[n,i]),p=h.useCallback(r=>{const u=typeof r.target.value=="string"?r.target.value.split(","):r.target.value;n(),i({role:u})},[n,i]),l=()=>e.jsx(J,{open:c.open,anchorEl:c.anchorEl,onClose:c.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(ee,{children:[e.jsxs(m,{onClick:()=>c.onClose(),children:[e.jsx(y,{icon:"solar:printer-minimalistic-bold"}),"Print"]}),e.jsxs(m,{onClick:()=>c.onClose(),children:[e.jsx(y,{icon:"solar:import-bold"}),"Import"]}),e.jsxs(m,{onClick:()=>c.onClose(),children:[e.jsx(y,{icon:"solar:export-bold"}),"Export"]})]})});return e.jsxs(e.Fragment,{children:[e.jsxs(f,{sx:{p:2.5,gap:2,display:"flex",pr:{xs:2.5,md:1},flexDirection:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"}},children:[e.jsxs(ue,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[e.jsx(xe,{htmlFor:"filter-role-select",children:"Role"}),e.jsx(me,{multiple:!0,label:"Role",value:a.role,onChange:p,renderValue:r=>r.map(u=>u).join(", "),inputProps:{id:"filter-role-select"},MenuProps:{PaperProps:{sx:{maxHeight:240}}},children:o.roles.map(r=>e.jsxs(m,{value:r,children:[e.jsx(se,{disableRipple:!0,size:"small",checked:a.role.includes(r),slotProps:{input:{id:`${r}-checkbox`}}}),r]},r))})]}),e.jsxs(f,{sx:{gap:2,width:1,flexGrow:1,display:"flex",alignItems:"center"},children:[e.jsx(Qe,{fullWidth:!0,value:a.name,onChange:d,placeholder:"Search...",slotProps:{input:{startAdornment:e.jsx(pe,{position:"start",children:e.jsx(y,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}}),e.jsx(B,{onClick:c.onOpen,children:e.jsx(y,{icon:"eva:more-vertical-fill"})})]})]}),l()]})}function Xe({filters:s,onResetPage:o,totalResults:n,sx:c}){const{state:a,setState:i,resetState:d}=s,p=h.useCallback(()=>{o(),i({name:""})},[o,i]),l=h.useCallback(()=>{o(),i({status:"all"})},[o,i]),r=h.useCallback(j=>{const w=a.role.filter(T=>T!==j);o(),i({role:w})},[o,i,a.role]),u=h.useCallback(()=>{o(),d()},[o,d]);return e.jsxs(ye,{totalResults:n,onReset:u,sx:c,children:[e.jsx(z,{label:"Status:",isShow:a.status!=="all",children:e.jsx($,{...G,label:a.status,onDelete:l,sx:{textTransform:"capitalize"}})}),e.jsx(z,{label:"Role:",isShow:!!a.role.length,children:a.role.map(j=>h.createElement($,{...G,key:j,label:j,onDelete:()=>r(j)}))}),e.jsx(z,{label:"Keyword:",isShow:!!a.name,children:e.jsx($,{...G,label:a.name,onDelete:p})})]})}const Ke=[{value:"all",label:"All"},...K],Ze=[{id:"name",label:"Name"},{id:"email",label:"Email",width:220},{id:"phoneNumber",label:"Phone number",width:180},{id:"roles",label:"Roles",width:200},{id:"status",label:"Status",width:100},{id:"",width:88}];function Ye(){const s=Ee(),o=_(),[n,c]=h.useState([]),[a,i]=h.useState({}),[d,p]=h.useState(!0),[l,r]=h.useState(""),[u,j]=h.useState([]),w=je({name:"",role:[],status:"all"}),{state:T,setState:V}=w,W=h.useCallback(async()=>{try{p(!0);const t=await fetch(P.API_URL+"/users",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"}),x=await t.json();if(t.ok){const R=x.users||[];c(R);const S={};for(const D of R)try{const F=await fetch(P.API_URL+`/users/${D.UID}/roles`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(F.ok){const oe=await F.json();S[D.UID]=oe.roles||[]}else S[D.UID]=[]}catch(F){console.error(`Error fetching roles for user ${D.UID}:`,F),S[D.UID]=[]}i(S)}else r(x.message||"Failed to fetch users")}catch(t){console.error("Error fetching users:",t),r("Failed to fetch users")}finally{p(!1)}},[]),H=h.useCallback(async()=>{try{const t=await fetch(P.API_URL+"/roles",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(t.ok){const x=await t.json();j(x.roles||[])}}catch(t){console.error("Error fetching roles:",t)}},[]);h.useEffect(()=>{W(),H()},[W,H]);const b=Je({inputData:n,comparator:Ue(s.order,s.orderBy),filters:T,userRoles:a}),q=Ie(b,s.page,s.rowsPerPage),X=!!T.name||T.role.length>0||T.status!=="all",re=!b.length&&X||!b.length,M=h.useCallback(async t=>{try{const x=await fetch(P.API_URL+`/users/${t}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"});if(x.ok){const R=n.filter(D=>D.UID!==t);c(R);const S={...a};delete S[t],i(S),A.success("Delete success!"),s.onUpdatePageDeleteRow(q.length)}else{const R=await x.json();A.error(R.message||"Failed to delete user")}}catch(x){console.error("Error deleting user:",x),A.error("Failed to delete user")}},[q.length,s,n,a]),le=h.useCallback(async()=>{try{for(const t of s.selected)await M(t);A.success(`${s.selected.length} users deleted successfully!`)}catch(t){console.error("Error deleting selected users:",t),A.error("Failed to delete some users")}},[s.selected,M]),ne=h.useCallback((t,x)=>{s.onResetPage(),V({status:x})},[V,s]),ae=()=>e.jsx(te,{open:o.value,onClose:o.onFalse,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",s.selected.length," "]})," items?"]}),action:e.jsx(I,{variant:"contained",color:"error",onClick:()=>{le(),o.onFalse()},children:"Delete"})});return d?e.jsx(O,{children:e.jsx(f,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:400},children:e.jsx(f,{children:"Loading users..."})})}):l?e.jsx(O,{children:e.jsx(f,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:400},children:e.jsx(f,{sx:{color:"error.main"},children:l})})}):e.jsxs(e.Fragment,{children:[e.jsxs(O,{children:[e.jsx($e,{heading:"Users List",links:[{name:"Dashboard",href:L.dashboard.root},{name:"Users",href:L.dashboard.users},{name:"List"}],action:e.jsx(I,{component:Q,href:L.dashboard.user.new,variant:"contained",startIcon:e.jsx(y,{icon:"mingcute:add-line"}),children:"Add user"}),sx:{mb:{xs:3,md:5}}}),e.jsxs(U,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(E,{sx:{p:3,textAlign:"center"},children:[e.jsx(g,{variant:"h4",color:"primary.main",gutterBottom:!0,children:n.length}),e.jsx(g,{variant:"h6",gutterBottom:!0,children:"Total Users"}),e.jsx(g,{variant:"body2",color:"text.secondary",children:"All registered users"})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(E,{sx:{p:3,textAlign:"center"},children:[e.jsx(g,{variant:"h4",color:"success.main",gutterBottom:!0,children:n.filter(t=>t.status==="active").length}),e.jsx(g,{variant:"h6",gutterBottom:!0,children:"Active Users"}),e.jsx(g,{variant:"body2",color:"text.secondary",children:"Currently active"})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(E,{sx:{p:3,textAlign:"center"},children:[e.jsx(g,{variant:"h4",color:"warning.main",gutterBottom:!0,children:n.filter(t=>t.status==="pending").length}),e.jsx(g,{variant:"h6",gutterBottom:!0,children:"Pending Users"}),e.jsx(g,{variant:"body2",color:"text.secondary",children:"Awaiting approval"})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(E,{sx:{p:3,textAlign:"center"},children:[e.jsx(g,{variant:"h4",color:"error.main",gutterBottom:!0,children:n.filter(t=>t.status==="banned").length}),e.jsx(g,{variant:"h6",gutterBottom:!0,children:"Banned Users"}),e.jsx(g,{variant:"body2",color:"text.secondary",children:"Suspended accounts"})]})})]}),e.jsxs(E,{children:[e.jsx(ge,{value:T.status,onChange:ne,sx:[t=>({px:{md:2.5},boxShadow:`inset 0 -2px 0 0 ${fe(t.vars.palette.grey["500Channel"],.08)}`})],children:Ke.map(t=>e.jsx(be,{iconPosition:"end",value:t.value,label:t.label,icon:e.jsx(N,{variant:(t.value==="all"||t.value===T.status)&&"filled"||"soft",color:t.value==="active"&&"success"||t.value==="pending"&&"warning"||t.value==="banned"&&"error"||"default",children:t.value==="all"?n.length:n.filter(x=>x.status===t.value).length})},t.value))}),e.jsx(qe,{filters:w,onResetPage:s.onResetPage,options:{roles:u.map(t=>t.ROLENAME)}}),X&&e.jsx(Xe,{filters:w,totalResults:b.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(f,{sx:{position:"relative"},children:[e.jsx(Fe,{dense:s.dense,numSelected:s.selected.length,rowCount:b.length,onSelectAllRows:t=>s.onSelectAllRows(t,b.map(x=>x.UID)),action:e.jsx(Y,{title:"Delete",children:e.jsx(B,{color:"primary",onClick:o.onTrue,children:e.jsx(y,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(ve,{children:e.jsxs(ze,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Pe,{order:s.order,orderBy:s.orderBy,headCells:Ze,rowCount:b.length,numSelected:s.selected.length,onSort:s.onSort,onSelectAllRows:t=>s.onSelectAllRows(t,b.map(x=>x.UID))}),e.jsxs(Ge,{children:[b.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(t=>e.jsx(He,{row:t,userRoles:a[t.UID]||[],selected:s.selected.includes(t.UID),onSelectRow:()=>s.onSelectRow(t.UID),onDeleteRow:()=>M(t.UID),editHref:L.dashboard.users},t.UID)),e.jsx(Le,{height:s.dense?56:76,emptyRows:Ne(s.page,s.rowsPerPage,b.length)}),e.jsx(Be,{notFound:re})]})]})})]}),e.jsx(Me,{page:s.page,dense:s.dense,count:b.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})]}),ae()]})}function Je({inputData:s,comparator:o,filters:n,userRoles:c}){const{name:a,status:i,role:d}=n,p=s.map((l,r)=>[l,r]);return p.sort((l,r)=>{const u=o(l[0],r[0]);return u!==0?u:l[1]-r[1]}),s=p.map(l=>l[0]),a&&(s=s.filter(l=>`${l.FIRSTNAME} ${l.LASTNAME}`.toLowerCase().includes(a.toLowerCase())||l.EMAIL.toLowerCase().includes(a.toLowerCase()))),i!=="all"&&(s=s.filter(l=>l.status===i)),d.length&&(s=s.filter(l=>{const r=c[l.UID]||[];return d.some(u=>r.some(j=>j.ROLENAME===u))})),s}const es={title:`Users | Dashboard - ${Ce.appName}`};function xs(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:es.title}),e.jsx(Ye,{})]})}export{xs as default};
