import{r as h,j as e,Q as $,I as A,V as H,W as D,X as W,Y as z,d as M,B as E,ab as L,z as G,E as q,p as R,G as Q,e as X,w as N,R as Y,k as J,ad as K}from"./index-C-qVRBSV.js";import{t as Z}from"./index-CEYZzIqm.js";import{C as ee}from"./custom-breadcrumbs-B3R0xW3I.js";import{S as C}from"./Stack-BWd6IFBr.js";import{T as ae}from"./TextField-_5Ol588q.js";import{T as te}from"./TableContainer-CW91VIrV.js";import{b as se,d as ne,T as O,a as p,c as le}from"./TableHead-D9WzJI8t.js";import{T as re}from"./TableSortLabel-DktZE9EQ.js";function oe({filters:r,onFilters:d,onResetFilters:i,methodOptions:c}){const m=h.useCallback(t=>{d("name",t.target.value)},[d]),x=h.useCallback(t=>{const a=t.target.value;a.includes("all")?d("method",["all"]):d("method",a)},[d]);return e.jsxs(C,{spacing:2,alignItems:{xs:"flex-end",md:"center"},direction:{xs:"column",md:"row"},sx:{p:2.5,pr:{xs:2.5,md:1}},children:[e.jsxs(C,{direction:"row",alignItems:"center",spacing:2,flexGrow:1,sx:{width:1},children:[e.jsx(ae,{fullWidth:!0,value:r.name,onChange:m,placeholder:"Search...",InputProps:{startAdornment:e.jsx($,{position:"start",children:e.jsx(A,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(H,{sx:{minWidth:200},children:[e.jsx(D,{children:"Payment Method"}),e.jsx(W,{multiple:!0,value:r.method,onChange:x,input:e.jsx(D,{children:"Payment Method"}),renderValue:t=>t.includes("all")?"All Methods":t.join(", "),children:c.map(t=>e.jsx(z,{value:t.value,children:t.label},t.value))})]})]}),e.jsx(M,{color:"error",onClick:i,startIcon:e.jsx(A,{icon:"solar:trash-bin-trash-bold"}),children:"Clear"})]})}function ie({filters:r,onFilters:d,onResetFilters:i,onRemoveMethod:c,onRemoveName:m,results:x,sx:t,...a}){const n=b=>{c(b)},o=()=>{m()},s=r.name!==""||r.method.length>0&&!r.method.includes("all");return e.jsxs(C,{spacing:1.5,...a,sx:{...t},children:[e.jsxs(E,{sx:{typography:"body2"},children:[e.jsx("strong",{children:x}),e.jsx(E,{component:"span",sx:{color:"text.secondary",ml:.25},children:"results found"})]}),s&&e.jsxs(C,{flexGrow:1,spacing:1,direction:"row",flexWrap:"wrap",alignItems:"center",children:[r.name!==""&&e.jsx(y,{label:"Name:",children:e.jsx(L,{size:"small",label:r.name,onDelete:o})}),r.method.length>0&&!r.method.includes("all")&&e.jsx(y,{label:"Payment Method:",children:r.method.map(b=>e.jsx(L,{label:b,size:"small",onDelete:()=>n(b)},b))}),e.jsx(M,{color:"error",onClick:i,startIcon:e.jsx(A,{icon:"solar:trash-bin-trash-bold"}),children:"Clear"})]})]})}function y({label:r,children:d,sx:i,...c}){return e.jsxs(C,{component:E,direction:"row",alignItems:"center",sx:{typography:"body2","& .MuiChip-root":{ml:1},...i},...c,children:[r,d]})}const I={title:`Transactions | Dashboard - ${X.appName}`},ce=[{id:"RECEIPT_NUMBER",label:"Receipt Number",alignRight:!1},{id:"donor_name",label:"Donor Name",alignRight:!1},{id:"EMAIL",label:"Email",alignRight:!1},{id:"AMOUNT",label:"Amount",alignRight:!1},{id:"METHOD",label:"Payment Method",alignRight:!1},{id:"TRANSACTION_DATE",label:"Date",alignRight:!1},{id:"",label:"Actions",alignRight:!0}];function Ae(){const r=G(),{authenticated:d}=q(),[i,c]=h.useState([]),[m,x]=h.useState(!0),[t,a]=h.useState(null),[n,o]=h.useState("asc"),[s,b]=h.useState("TRANSACTION_DATE"),[T,w]=h.useState({name:"",method:["all"]}),j=he({inputData:i||[],filters:T,order:n,orderBy:s}),F=j.slice(0,j.length),k=T.name!==""||T.method.length>0&&!T.method.includes("all"),_=!j.length&&k||!j.length,f=h.useCallback((l,u)=>{w(g=>({...g,[l]:u}))},[]),S=h.useCallback(()=>{w({name:"",method:["all"]})},[]),V=h.useCallback(l=>{const u=T.method.filter(g=>g!==l);f("method",u)},[T.method,f]),P=h.useCallback(()=>{f("name","")},[f]),B=h.useCallback(l=>{r.push(R.dashboard.transactions+`/${l}`)},[r]),U=h.useCallback((l,u)=>{u!==""&&(o(s===u&&n==="asc"?"desc":"asc"),b(u))},[n,s]),v=h.useCallback(async()=>{var l;try{x(!0),a(null);const g=((l=(await Q.get("/transactions")).data)==null?void 0:l.transactions)||[];c(Array.isArray(g)?g:[])}catch(u){console.error("Error fetching transactions:",u),a(u.message),Z.error("Failed to fetch transactions"),c([])}finally{x(!1)}},[]);return h.useEffect(()=>{d&&v()},[d,v]),d?m?e.jsxs(e.Fragment,{children:[e.jsx("title",{children:I.title}),e.jsx(N,{maxWidth:"xl",children:e.jsx("div",{children:"Loading transactions..."})})]}):t?e.jsxs(e.Fragment,{children:[e.jsx("title",{children:I.title}),e.jsx(N,{maxWidth:"xl",children:e.jsxs("div",{children:["Error loading transactions: ",t]})})]}):e.jsxs(e.Fragment,{children:[e.jsx("title",{children:I.title}),e.jsxs(N,{maxWidth:"xl",children:[e.jsx(ee,{heading:"Transactions",links:[{name:"Dashboard",href:R.dashboard.root},{name:"Transactions"}],action:e.jsx(M,{component:Y,href:R.dashboard.transactions,variant:"contained",startIcon:e.jsx(A,{icon:"mingcute:add-line"}),children:"New Transaction"}),sx:{mb:{xs:3,md:5}}}),e.jsxs(J,{children:[e.jsx(oe,{filters:T,onFilters:f,onResetFilters:S,methodOptions:[{value:"all",label:"All Methods"},{value:"credit_card",label:"Credit Card"},{value:"paypal",label:"PayPal"},{value:"bank_transfer",label:"Bank Transfer"}]}),i&&Array.isArray(i)&&i.length>0?e.jsx(te,{sx:{position:"relative",overflow:"unset"},children:e.jsx(K,{children:e.jsxs(se,{size:"medium",sx:{minWidth:960},children:[e.jsx(ne,{children:e.jsx(O,{children:ce.map(l=>e.jsx(p,{align:l.alignRight?"right":"left",sortDirection:s===l.id?n:!1,children:l.id===""?l.label:e.jsxs(re,{hideSortIcon:!0,active:s===l.id,direction:s===l.id?n:"asc",onClick:u=>U(u,l.id),children:[l.label,s===l.id?e.jsx(E,{sx:{...ue},children:n==="desc"?"sorted descending":"sorted ascending"}):null]})},l.id))})}),e.jsx(le,{children:F.map(l=>e.jsx(de,{row:l,onViewRow:()=>B(l.TRANSACTION_ID)},l.TRANSACTION_ID))})]})})}):e.jsx("div",{style:{padding:"20px",textAlign:"center"},children:_?"No transactions found":"No transaction data available"})]}),e.jsx(ie,{filters:T,onFilters:f,onResetFilters:S,onRemoveMethod:V,onRemoveName:P,results:j.length,sx:{p:2.5,pt:0}})]})]}):(r.push("/login"),null)}function de({row:r,onViewRow:d}){const{RECEIPT_NUMBER:i,EMAIL:c,AMOUNT:m,METHOD:x,TRANSACTION_DATE:t,FIRSTNAME:a,LASTNAME:n}=r,o=a&&n?`${a} ${n}`:"N/A";return e.jsxs(O,{hover:!0,children:[e.jsx(p,{children:i}),e.jsx(p,{children:o}),e.jsx(p,{children:c}),e.jsxs(p,{children:["$",m]}),e.jsx(p,{children:x}),e.jsx(p,{children:new Date(t).toLocaleDateString()}),e.jsx(p,{align:"right",children:e.jsx(A,{icon:"solar:eye-bold",sx:{cursor:"pointer",color:"primary.main"},onClick:d})})]})}function he({inputData:r,filters:d,order:i,orderBy:c}){const{name:m,method:x}=d;if(!r||!Array.isArray(r))return[];let t=[...r];return m&&(t=t.filter(a=>a.RECEIPT_NUMBER.toLowerCase().indexOf(m.toLowerCase())!==-1||a.EMAIL.toLowerCase().indexOf(m.toLowerCase())!==-1||`${a.FIRSTNAME||""} ${a.LASTNAME||""}`.toLowerCase().indexOf(m.toLowerCase())!==-1)),x.length>0&&!x.includes("all")&&(t=t.filter(a=>x.includes(a.METHOD))),c==="RECEIPT_NUMBER"?t.sort((a,n)=>{const o=a.RECEIPT_NUMBER,s=n.RECEIPT_NUMBER;return i==="asc"?o.localeCompare(s):s.localeCompare(o)}):c==="donor_name"?t.sort((a,n)=>{const o=`${a.FIRSTNAME||""} ${a.LASTNAME||""}`.toLowerCase(),s=`${n.FIRSTNAME||""} ${n.LASTNAME||""}`.toLowerCase();return i==="asc"?o.localeCompare(s):s.localeCompare(o)}):c==="EMAIL"?t.sort((a,n)=>{const o=a.EMAIL.toLowerCase(),s=n.EMAIL.toLowerCase();return i==="asc"?o.localeCompare(s):s.localeCompare(o)}):c==="AMOUNT"?t.sort((a,n)=>{const o=parseFloat(a.AMOUNT),s=parseFloat(n.AMOUNT);return i==="asc"?o-s:s-o}):c==="METHOD"?t.sort((a,n)=>{const o=a.METHOD.toLowerCase(),s=n.METHOD.toLowerCase();return i==="asc"?o.localeCompare(s):s.localeCompare(o)}):c==="TRANSACTION_DATE"&&t.sort((a,n)=>{const o=new Date(a.TRANSACTION_DATE).getTime(),s=new Date(n.TRANSACTION_DATE).getTime();return i==="asc"?o-s:s-o}),t}const ue={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};export{Ae as default};
