import{z as J,E as q,r as j,J as b,K as D,j as e,e as Q,w as v,p as A,k as p,T as n,a9 as N,B as C,a5 as k}from"./index-FMbyiGBg.js";import{C as V}from"./custom-breadcrumbs-BYE_vmd6.js";import{G as T}from"./Grid-D0Xua7tw.js";import{T as B}from"./TableContainer-DFE7AUh4.js";import{b as W,d as w,T as y,a as c,c as $}from"./TableHead-CZEiNHrS.js";import{S as L}from"./Stack-C1li3Gzt.js";const _={title:`My Schedule | Student Dashboard - ${Q.appName}`};function oe(){const F=J(),{authenticated:g,user:d}=q(),[f,H]=j.useState([]),[h,z]=j.useState({}),[K,I]=j.useState(!0),R=j.useCallback(async()=>{if(d!=null&&d.UID)try{I(!0);const o=(await b.get(D.courses.list)).data.courses||[],r=[];for(const l of o)try{const m=((await b.get(D.courses.students(l.COURSEID))).data.students||[]).find(S=>S.UID===d.UID);m&&r.push({...l,enrollment:m})}catch(a){console.error(`Error fetching enrollment for course ${l.COURSEID}:`,a)}H(r);const t={};for(const l of r)try{const a=await b.get(D.courses.schedule(l.COURSEID));t[l.COURSEID]=a.data.schedule||[]}catch(a){console.error(`Error fetching schedule for course ${l.COURSEID}:`,a),t[l.COURSEID]=[]}z(t)}catch(s){console.error("Error fetching enrolled courses:",s)}finally{I(!1)}},[d==null?void 0:d.UID]);if(j.useEffect(()=>{g&&(d!=null&&d.UID)&&R()},[g,d==null?void 0:d.UID,R]),!g)return F.push("/login"),null;const E=s=>{const o=new Date,r=new Date(s.STARTDATE),t=new Date(s.ENDDATE);return r>o?{label:"Upcoming",color:"info"}:r<=o&&t>=o?{label:"Ongoing",color:"success"}:{label:"Completed",color:"default"}},M=s=>new Date(s).toLocaleDateString(),i=s=>{if(!s)return"TBD";const o=new Date(`2000-01-01T${s}`),r=o.getHours(),t=o.getMinutes(),l=r>=12?"PM":"AM",a=r%12||12,u=t.toString().padStart(2,"0");return`${a}:${u} ${l}`},O=s=>({Monday:"Mon",Tuesday:"Tue",Wednesday:"Wed",Thursday:"Thu",Friday:"Fri",Saturday:"Sat",Sunday:"Sun"})[s]||s,Y=()=>{const s=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],o=["08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00"],r={};return s.forEach(t=>{r[t]={},o.forEach(l=>{r[t][l]=[]})}),f.forEach(t=>{(h[t.COURSEID]||[]).forEach(a=>{const u=a.WEEKDAY,m=a.START_TIME,S=a.END_TIME;o.forEach(x=>{x>=m&&x<S&&(r[u][x]||(r[u][x]=[]),r[u][x].push({course:t,scheduleItem:a}))})})}),{weekdays:s,timeSlots:o,schedule:r}},{weekdays:U,timeSlots:G,schedule:P}=Y();return K?e.jsxs(e.Fragment,{children:[e.jsx("title",{children:_.title}),e.jsx(v,{maxWidth:"xl",children:e.jsx("div",{children:"Loading your schedule..."})})]}):e.jsxs(e.Fragment,{children:[e.jsx("title",{children:_.title}),e.jsxs(v,{maxWidth:"xl",children:[e.jsx(V,{heading:"My Schedule",links:[{name:"Dashboard",href:A.dashboard.root},{name:"Student",href:A.dashboard.student.courses},{name:"My Schedule"}],sx:{mb:{xs:3,md:5}}}),f.length===0?e.jsxs(p,{sx:{p:4,textAlign:"center"},children:[e.jsx(n,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"You are not enrolled in any courses yet."}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Contact an administrator to enroll you in courses."})]}):e.jsxs(T,{container:!0,spacing:3,children:[e.jsx(T,{item:!0,xs:12,children:e.jsxs(p,{sx:{p:3},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Weekly Schedule"}),e.jsx(B,{component:N,variant:"outlined",sx:{maxHeight:600},children:e.jsxs(W,{stickyHeader:!0,sx:{"& .MuiTableCell-root":{border:"1px solid #e0e0e0",backgroundColor:"#fafafa"},"& .MuiTableHead-root .MuiTableCell-root":{backgroundColor:"#f5f5f5",fontWeight:"bold",border:"1px solid #d0d0d0"},"& .MuiTableBody-root .MuiTableRow:nth-of-type(even) .MuiTableCell-root":{backgroundColor:"#ffffff"},"& .MuiTableBody-root .MuiTableRow:nth-of-type(odd) .MuiTableCell-root":{backgroundColor:"#f9f9f9"}},children:[e.jsx(w,{children:e.jsxs(y,{children:[e.jsx(c,{sx:{minWidth:80},children:"Time"}),U.map(s=>e.jsx(c,{sx:{minWidth:120,textAlign:"center"},children:s},s))]})}),e.jsx($,{children:G.map(s=>e.jsxs(y,{children:[e.jsx(c,{sx:{fontWeight:"bold",fontSize:"0.875rem"},children:i(s)}),U.map(o=>{const r=P[o][s]||[];return e.jsx(c,{sx:{p:1},children:r.map((t,l)=>{const a=E(t.course);return e.jsxs(C,{sx:{p:1,mb:.5,borderRadius:1,backgroundColor:a.color==="success"?"success.light":a.color==="info"?"info.light":"grey.100",border:`1px solid ${a.color==="success"?"success.main":a.color==="info"?"info.main":"grey.300"}`,fontSize:"0.75rem",lineHeight:1.2},children:[e.jsx(n,{variant:"caption",sx:{fontWeight:"bold",display:"block"},children:t.course.TITLE}),e.jsxs(n,{variant:"caption",sx:{display:"block"},children:[i(t.scheduleItem.START_TIME)," - ",i(t.scheduleItem.END_TIME)]}),e.jsx(n,{variant:"caption",sx:{display:"block"},children:t.course.LOCATION})]},`${t.course.COURSEID}-${l}`)})},`${o}-${s}`)})]},s))})]})})]})}),e.jsx(T,{item:!0,xs:12,children:e.jsxs(p,{sx:{p:3},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Course Schedule Details"}),e.jsx(B,{component:N,variant:"outlined",children:e.jsxs(W,{children:[e.jsx(w,{children:e.jsxs(y,{children:[e.jsx(c,{children:"Course"}),e.jsx(c,{children:"Location"}),e.jsx(c,{children:"Schedule"}),e.jsx(c,{children:"Status"}),e.jsx(c,{children:"Instructor"})]})}),e.jsx($,{children:f.map(s=>{const o=E(s),r=h[s.COURSEID]||[];return e.jsxs(y,{children:[e.jsx(c,{children:e.jsx(n,{variant:"subtitle2",children:s.TITLE})}),e.jsx(c,{children:s.LOCATION}),e.jsx(c,{children:r.length>0?e.jsx(L,{spacing:.5,children:r.map((t,l)=>e.jsxs(n,{variant:"body2",children:[O(t.WEEKDAY),": ",i(t.START_TIME)," - ",i(t.END_TIME)]},l))}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"No schedule set"})}),e.jsx(c,{children:e.jsx(k,{label:o.label,color:o.color,size:"small"})}),e.jsx(c,{children:s.INSTRUCTOR_NAME||"TBD"})]},s.COURSEID)})})]})})]})}),e.jsx(T,{item:!0,xs:12,children:e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Course Details"})}),f.map(s=>{const o=E(s);return e.jsx(T,{item:!0,xs:12,md:6,lg:4,children:e.jsx(p,{sx:{p:3,height:"100%"},children:e.jsxs(L,{spacing:2,children:[e.jsxs(C,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:s.TITLE}),e.jsx(k,{label:o.label,color:o.color,size:"small"})]}),e.jsxs(C,{children:[e.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Location:"})," ",s.LOCATION]}),e.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Start Date:"})," ",M(s.STARTDATE)]}),e.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"End Date:"})," ",M(s.ENDDATE)]}),e.jsx(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:e.jsx("strong",{children:"Schedule:"})}),h[s.COURSEID]&&h[s.COURSEID].length>0?h[s.COURSEID].map((r,t)=>e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{pl:2},children:[O(r.WEEKDAY),": ",i(r.START_TIME)," - ",i(r.END_TIME)]},t)):e.jsx(n,{variant:"body2",color:"text.secondary",sx:{pl:2},children:"No schedule set"}),s.INSTRUCTOR_NAME&&e.jsxs(n,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Instructor:"})," ",s.INSTRUCTOR_NAME]})]})]})})},s.COURSEID)})]})]})]})}export{oe as default};
