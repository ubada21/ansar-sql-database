import{z as Oe,E as Me,r as c,G as j,O as S,j as e,e as Ge,w as ne,p as M,k as G,T as n,B as d,ab as L,d as y,I as D,K as oe,ae as Le,n as Be,a8 as ae,N as ie}from"./index-B-O2wvL4.js";import{C as Fe}from"./custom-breadcrumbs-C2AuKEDp.js";import{G as E}from"./Grid-Ba55pw_4.js";import{S as I}from"./Stack-BjYbPdpy.js";import{D as le,a as ce}from"./DialogTitle-w8z7uk1s.js";import{T as We}from"./TableContainer-BkKYrVIR.js";import{b as ke,d as $e,T as de,a as u,c as ze}from"./TableHead-CcFJ9gr-.js";import{D as ue}from"./DialogActions-DZ5SCz5y.js";import{T as _e}from"./TextField-BfDbW8wr.js";const xe={title:`My Courses | Instructor Dashboard - ${Ge.appName}`};function Ze(){const B=Oe(),{authenticated:R,user:o}=Me(),[A,he]=c.useState([]),[T,pe]=c.useState({}),[ge,F]=c.useState(!0),[me,W]=c.useState(!1),[x,k]=c.useState(null),[$,g]=c.useState([]),[fe,z]=c.useState(!1),[je,_]=c.useState(!1),[h,P]=c.useState(null),[m,w]=c.useState(""),[v,Y]=c.useState(!1),[Se,H]=c.useState(!1),K=c.useCallback(async()=>{if(o!=null&&o.UID)try{F(!0);const s=((await j.get(S.courses.list)).data.courses||[]).filter(i=>{const l=i.INSTRUCTOR_IDS?i.INSTRUCTOR_IDS.split(","):[],p=i.INSTRUCTOR_NAMES?i.INSTRUCTOR_NAMES.split(","):[],b=`${o.FIRSTNAME} ${o.LASTNAME}`;return l.includes(o.UID.toString())||p.includes(b)});he(s);const a={};for(const i of s)try{const l=await j.get(S.courses.schedule(i.COURSEID));a[i.COURSEID]=l.data.schedule||[]}catch(l){console.error(`Error fetching schedule for course ${i.COURSEID}:`,l),a[i.COURSEID]=[]}pe(a)}catch(t){console.error("Error fetching teaching courses:",t)}finally{F(!1)}},[o==null?void 0:o.UID,o==null?void 0:o.FIRSTNAME,o==null?void 0:o.LASTNAME]);if(c.useEffect(()=>{R&&(o!=null&&o.UID)&&K()},[R,o==null?void 0:o.UID,K]),!R)return B.push("/login"),null;const q=t=>{const r=new Date,s=new Date(t.STARTDATE),a=new Date(t.ENDDATE);return s>r?{label:"Upcoming",color:"info"}:s<=r&&a>=r?{label:"Ongoing",color:"success"}:{label:"Completed",color:"default"}},N=t=>new Date(t).toLocaleDateString(),f=t=>{if(!t)return"TBD";const r=new Date(`2000-01-01T${t}`),s=r.getHours(),a=r.getMinutes(),i=s>=12?"PM":"AM",l=s%12||12,p=a.toString().padStart(2,"0");return`${l}:${p} ${i}`},C=t=>{const[r,s]=t.split(":").map(Number);return r*60+s},J=t=>({Monday:"Mon",Tuesday:"Tue",Wednesday:"Wed",Thursday:"Thu",Friday:"Fri",Saturday:"Sat",Sunday:"Sun"})[t]||t,ye=t=>{switch(t==null?void 0:t.toLowerCase()){case"active":return"success";case"completed":return"primary";case"withdrawn":return"warning";case"failed":return"error";default:return"default"}},Te=t=>t?t>=90?"success":t>=80?"primary":t>=70?"warning":"error":"default",Ce=t=>t?t>=90?"A":t>=80?"B":t>=70?"C":t>=60?"D":"F":"N/A",be=async t=>{k(t),W(!0),z(!0);try{const r=await j.get(S.courses.students(t.COURSEID));g(r.data.students||[])}catch(r){console.error("Error fetching students:",r),g([])}finally{z(!1)}},Q=()=>{W(!1),k(null),g([])},De=t=>{P(t),w(t.FINAL_GRADE||""),_(!0)},U=()=>{_(!1),P(null),w("")},Ee=async()=>{if(!(!h||!m)){Y(!0);try{await j.put(S.courses.updateGrade(x.COURSEID,h.UID),{finalGrade:parseFloat(m)}),g(t=>t.map(r=>r.UID===h.UID?{...r,FINAL_GRADE:parseFloat(m)}:r)),U()}catch(t){console.error("Error updating grade:",t)}finally{Y(!1)}}},Ie=async t=>{if(x){H(!0);try{await j.delete(S.courses.removeStudent(x.COURSEID,t.UID)),g(r=>r.filter(s=>s.UID!==t.UID))}catch(r){console.error("Error removing student:",r)}finally{H(!1)}}},Re=()=>{const t=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],r=["08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00"],s=[];return A.forEach(a=>{(T[a.COURSEID]||[]).forEach(l=>{const p=l.WEEKDAY,b=l.START_TIME,Z=l.END_TIME;if(t.includes(p)){const ee=C(b),te=C(Z),re=t.indexOf(p),we=r.findIndex(O=>C(O)>=ee),se=r.findIndex(O=>C(O)>=te),ve=re+2,Ne=we+2,Ue=se>-1?se+2:r.length+2;s.push({course:a,scheduleItem:l,startTime:b,endTime:Z,day:p,dayIndex:re,gridColumn:ve,gridRowStart:Ne,gridRowEnd:Ue,startMinutes:ee,endMinutes:te})}})}),{weekdays:t,timeSlots:r,courseBlocks:s}},{weekdays:V,timeSlots:X,courseBlocks:Ae}=Re();return ge?e.jsxs(e.Fragment,{children:[e.jsx("title",{children:xe.title}),e.jsx(ne,{maxWidth:"xl",children:e.jsx("div",{children:"Loading your courses..."})})]}):e.jsxs(e.Fragment,{children:[e.jsx("title",{children:xe.title}),e.jsxs(ne,{maxWidth:"xl",children:[e.jsx(Fe,{heading:"My Courses",links:[{name:"Dashboard",href:M.dashboard.root},{name:"Instructor",href:M.dashboard.instructor.courses},{name:"My Courses"}],sx:{mb:{xs:3,md:5}}}),A.length===0?e.jsxs(G,{sx:{p:4,textAlign:"center"},children:[e.jsx(n,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"You are not assigned to teach any courses yet."}),e.jsx(n,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Contact an administrator to assign you to courses."})]}):e.jsxs(e.Fragment,{children:[e.jsx(E,{container:!0,spacing:3,sx:{mt:2},children:e.jsx(E,{item:!0,xs:12,children:e.jsxs(G,{sx:{p:3},children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:"Weekly Schedule"}),e.jsxs(d,{sx:{display:"grid",gridTemplateColumns:"80px repeat(7, 1fr)",gridTemplateRows:"auto repeat(14, 60px)",gap:0,mt:2,border:"1px solid #e0e0e0",borderRadius:1,overflow:"hidden",position:"relative"},children:[e.jsx(d,{sx:{gridColumn:"1",gridRow:"1",backgroundColor:"#f5f5f5",borderRight:"1px solid #e0e0e0",borderBottom:"1px solid #e0e0e0",p:1,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"0.875rem"},children:"Time"}),V.map((t,r)=>e.jsx(d,{sx:{gridColumn:`${r+2}`,gridRow:"1",backgroundColor:"#f5f5f5",borderBottom:"1px solid #e0e0e0",borderRight:"1px solid #e0e0e0",p:1,textAlign:"center",fontWeight:"bold",fontSize:"0.875rem"},children:J(t)},t)),X.map((t,r)=>e.jsx(d,{sx:{gridColumn:"1",gridRow:`${r+2}`,backgroundColor:"#f9f9f9",borderRight:"1px solid #e0e0e0",borderBottom:"1px solid #e0e0e0",p:1,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"0.75rem"},children:f(t)},t)),X.map((t,r)=>V.map((s,a)=>e.jsx(d,{sx:{gridColumn:`${a+2}`,gridRow:`${r+2}`,borderRight:"1px solid #e0e0e0",borderBottom:"1px solid #e0e0e0",backgroundColor:r%2===0?"#ffffff":"#fafafa"}},`${s}-${t}`))),Ae.map((t,r)=>{const s=q(t.course);return e.jsxs(d,{sx:{gridColumn:t.gridColumn,gridRow:`${t.gridRowStart} / ${t.gridRowEnd}`,backgroundColor:s.color==="success"?"success.light":s.color==="info"?"info.light":"grey.100",border:`2px solid ${s.color==="success"?"success.main":s.color==="info"?"info.main":"grey.300"}`,borderRadius:1,p:1,m:.5,fontSize:"0.7rem",lineHeight:1.1,display:"flex",flexDirection:"column",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",cursor:"pointer",transition:"all 0.2s ease",zIndex:1,"&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.2)",transform:"translateY(-1px)",zIndex:2}},children:[e.jsx(n,{variant:"caption",sx:{fontWeight:"bold",display:"block",textAlign:"center",fontSize:"0.65rem",mb:.5},children:t.course.TITLE}),e.jsxs(n,{variant:"caption",sx:{display:"block",textAlign:"center",fontSize:"0.6rem",opacity:.8,mb:.5},children:[f(t.startTime)," - ",f(t.endTime)]}),e.jsx(n,{variant:"caption",sx:{display:"block",textAlign:"center",fontSize:"0.6rem",opacity:.7},children:t.course.LOCATION})]},`${t.course.COURSEID}-${r}`)})]})]})})}),e.jsx(E,{container:!0,spacing:3,sx:{mt:2},children:A.map(t=>{const r=q(t);return e.jsx(E,{item:!0,xs:12,md:6,lg:4,children:e.jsx(G,{sx:{p:3,height:"100%",border:"1px solid #e0e0e0",borderRadius:2,boxShadow:"0 4px 12px rgba(0,0,0,0.1)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 24px rgba(0,0,0,0.15)",transform:"translateY(-4px)",borderColor:"primary.main"}},children:e.jsxs(I,{spacing:2,children:[e.jsxs(d,{children:[e.jsx(n,{variant:"h6",gutterBottom:!0,children:t.TITLE}),e.jsx(I,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:e.jsx(L,{label:r.label,color:r.color,size:"small"})})]}),e.jsxs(d,{children:[e.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Location:"})," ",t.LOCATION]}),e.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Start Date:"})," ",N(t.STARTDATE)]}),e.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"End Date:"})," ",N(t.ENDDATE)]}),e.jsx(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:e.jsx("strong",{children:"Schedule:"})}),T[t.COURSEID]&&T[t.COURSEID].length>0?T[t.COURSEID].map((s,a)=>e.jsxs(n,{variant:"body2",color:"text.secondary",sx:{pl:2},children:[J(s.WEEKDAY),": ",f(s.START_TIME)," - ",f(s.END_TIME)]},a)):e.jsx(n,{variant:"body2",color:"text.secondary",sx:{pl:2},children:"No schedule set"})]}),e.jsxs(I,{direction:"row",spacing:1,children:[e.jsx(y,{size:"small",variant:"outlined",startIcon:e.jsx(D,{icon:"eva:people-fill"}),onClick:()=>be(t),children:"Students"}),e.jsx(y,{size:"small",variant:"outlined",startIcon:e.jsx(D,{icon:"eva:file-text-fill"}),onClick:()=>B.push(M.dashboard.instructor.grades),children:"Grades"})]})]})})},t.COURSEID)})})]}),e.jsxs(oe,{open:me,onClose:Q,maxWidth:"lg",fullWidth:!0,children:[e.jsxs(le,{children:["Students in ",x==null?void 0:x.TITLE]}),e.jsx(ce,{children:fe?e.jsx(d,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(n,{children:"Loading students..."})}):$.length===0?e.jsxs(d,{sx:{p:3,textAlign:"center"},children:[e.jsx(n,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No students enrolled in this course yet."}),e.jsx(n,{variant:"body2",color:"text.secondary",children:"Students will appear here once they enroll."})]}):e.jsx(We,{component:Le,variant:"outlined",sx:{mt:2},children:e.jsxs(ke,{children:[e.jsx($e,{children:e.jsxs(de,{children:[e.jsx(u,{children:"Student"}),e.jsx(u,{children:"Email"}),e.jsx(u,{children:"Enrollment Status"}),e.jsx(u,{children:"Final Grade"}),e.jsx(u,{children:"Letter Grade"}),e.jsx(u,{children:"Enrollment Date"}),e.jsx(u,{children:"Actions"})]})}),e.jsx(ze,{children:$.map(t=>{var i,l;const r=t.FINAL_GRADE,s=Te(r),a=Ce(r);return e.jsxs(de,{children:[e.jsx(u,{children:e.jsxs(d,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Be,{sx:{width:40,height:40,bgcolor:"primary.main"},children:e.jsxs(n,{variant:"body2",children:[(i=t.FIRSTNAME)==null?void 0:i[0],(l=t.LASTNAME)==null?void 0:l[0]]})}),e.jsxs(d,{children:[e.jsxs(n,{variant:"subtitle2",children:[t.FIRSTNAME," ",t.LASTNAME]}),e.jsxs(n,{variant:"body2",color:"text.secondary",children:["ID: ",t.UID]})]})]})}),e.jsx(u,{children:e.jsx(n,{variant:"body2",children:t.EMAIL})}),e.jsx(u,{children:e.jsx(L,{label:t.STATUS,color:ye(t.STATUS),size:"small"})}),e.jsx(u,{children:r?e.jsx(d,{sx:{display:"flex",alignItems:"center",gap:1},children:e.jsxs(n,{variant:"body2",children:[r,"%"]})}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"Pending"})}),e.jsx(u,{children:r?e.jsx(L,{label:a,color:s,size:"small"}):e.jsx(n,{variant:"body2",color:"text.secondary",children:"N/A"})}),e.jsx(u,{children:N(t.ENROLL_DATE)}),e.jsx(u,{children:e.jsxs(I,{direction:"row",spacing:1,children:[e.jsx(ae,{title:"Edit Grade",children:e.jsx(ie,{size:"small",onClick:()=>De(t),color:"primary",children:e.jsx(D,{icon:"eva:edit-fill"})})}),e.jsx(ae,{title:"Remove Student",children:e.jsx(ie,{size:"small",onClick:()=>Ie(t),color:"error",disabled:Se,children:e.jsx(D,{icon:"eva:trash-2-fill"})})})]})})]},t.UID)})})]})})}),e.jsx(ue,{children:e.jsx(y,{onClick:Q,children:"Close"})})]}),e.jsxs(oe,{open:je,onClose:U,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(le,{children:["Update Grade for ",h==null?void 0:h.FIRSTNAME," ",h==null?void 0:h.LASTNAME]}),e.jsx(ce,{children:e.jsxs(d,{sx:{pt:2},children:[e.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Course: ",x==null?void 0:x.TITLE]}),e.jsx(_e,{fullWidth:!0,label:"Final Grade (%)",type:"number",value:m,onChange:t=>w(t.target.value),inputProps:{min:0,max:100,step:.1},sx:{mt:2}})]})}),e.jsxs(ue,{children:[e.jsx(y,{onClick:U,disabled:v,children:"Cancel"}),e.jsx(y,{onClick:Ee,variant:"contained",disabled:v||!m,children:v?"Updating...":"Update Grade"})]})]})]})]})}export{Ze as default};
