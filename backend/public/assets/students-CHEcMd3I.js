import{z as M,E as w,r as h,J as y,K as p,j as e,e as F,w as v,p as T,k as l,T as s,B as u,n as L,a5 as C,$ as O,V as _,I as $}from"./index-FMbyiGBg.js";import{C as k}from"./custom-breadcrumbs-BYE_vmd6.js";import{G as d}from"./Grid-D0Xua7tw.js";import{S}from"./Stack-C1li3Gzt.js";const b={title:`My Students | Instructor Dashboard - ${F.appName}`};function J(){const E=M(),{authenticated:g,user:t}=w(),[I,R]=h.useState([]),[x,D]=h.useState([]),[N,f]=h.useState(!0),j=h.useCallback(async()=>{if(t!=null&&t.UID)try{f(!0);const i=((await y.get(p.courses.list)).data.courses||[]).filter(o=>{const m=o.INSTRUCTOR_IDS?o.INSTRUCTOR_IDS.split(","):[],A=o.INSTRUCTOR_NAMES?o.INSTRUCTOR_NAMES.split(","):[],c=`${t.FIRSTNAME} ${t.LASTNAME}`;return m.includes(t.UID.toString())||A.includes(c)});R(i);const n=new Map;for(const o of i)try{((await y.get(p.courses.students(o.COURSEID))).data.students||[]).forEach(c=>{n.has(c.UID)||n.set(c.UID,{...c,courses:[]}),n.get(c.UID).courses.push({courseId:o.COURSEID,courseTitle:o.TITLE,enrollment:c})})}catch(m){console.error(`Error fetching students for course ${o.COURSEID}:`,m)}D(Array.from(n.values()))}catch(r){console.error("Error fetching teaching courses and students:",r)}finally{f(!1)}},[t==null?void 0:t.UID,t==null?void 0:t.FIRSTNAME,t==null?void 0:t.LASTNAME]);if(h.useEffect(()=>{g&&(t!=null&&t.UID)&&j()},[g,t==null?void 0:t.UID,j]),!g)return E.push("/login"),null;const U=r=>{switch(r==null?void 0:r.toLowerCase()){case"active":return"success";case"completed":return"primary";case"withdrawn":return"warning";case"failed":return"error";default:return"default"}},B=async(r,a)=>{if(confirm("Are you sure you want to remove this student from the course?"))try{await y.delete(p.courses.removeStudent(a,r)),j()}catch(i){console.error("Error removing student:",i),alert("Failed to remove student. Please try again.")}};return N?e.jsxs(e.Fragment,{children:[e.jsx("title",{children:b.title}),e.jsx(v,{maxWidth:"xl",children:e.jsx("div",{children:"Loading your students..."})})]}):e.jsxs(e.Fragment,{children:[e.jsx("title",{children:b.title}),e.jsxs(v,{maxWidth:"xl",children:[e.jsx(k,{heading:"My Students",links:[{name:"Dashboard",href:T.dashboard.root},{name:"Instructor",href:T.dashboard.instructor.courses},{name:"My Students"}],sx:{mb:{xs:3,md:5}}}),I.length===0?e.jsxs(l,{sx:{p:4,textAlign:"center"},children:[e.jsx(s,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"You are not assigned to teach any courses yet."}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Contact an administrator to assign you to courses."})]}):x.length===0?e.jsxs(l,{sx:{p:4,textAlign:"center"},children:[e.jsx(s,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No students are enrolled in your courses yet."}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Students will appear here once they enroll in your courses."})]}):e.jsxs(e.Fragment,{children:[e.jsxs(d,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(l,{sx:{p:3,textAlign:"center"},children:[e.jsx(s,{variant:"h4",color:"primary",gutterBottom:!0,children:x.length}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Total Students"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Across all courses"})]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(l,{sx:{p:3,textAlign:"center"},children:[e.jsx(s,{variant:"h4",color:"success.main",gutterBottom:!0,children:I.length}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Teaching Courses"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Active assignments"})]})}),e.jsx(d,{item:!0,xs:12,md:4,children:e.jsxs(l,{sx:{p:3,textAlign:"center"},children:[e.jsx(s,{variant:"h4",color:"info.main",gutterBottom:!0,children:x.filter(r=>r.courses.some(a=>a.enrollment.STATUS==="active")).length}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Active Students"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Currently enrolled"})]})})]}),e.jsx(d,{container:!0,spacing:3,children:x.map(r=>{var a,i;return e.jsx(d,{item:!0,xs:12,md:6,lg:4,children:e.jsx(l,{sx:{p:3,height:"100%"},children:e.jsxs(S,{spacing:2,children:[e.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(L,{sx:{width:60,height:60,bgcolor:"primary.main"},children:e.jsxs(s,{variant:"h6",children:[(a=r.FIRSTNAME)==null?void 0:a[0],(i=r.LASTNAME)==null?void 0:i[0]]})}),e.jsxs(u,{children:[e.jsxs(s,{variant:"h6",gutterBottom:!0,children:[r.FIRSTNAME," ",r.LASTNAME]}),e.jsx(s,{variant:"body2",color:"text.secondary",children:r.EMAIL})]})]}),e.jsxs(u,{children:[e.jsxs(s,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Student ID:"})," ",r.UID]}),e.jsxs(s,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Enrolled Courses:"})," ",r.courses.length]})]}),e.jsxs(u,{children:[e.jsx(s,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:e.jsx("strong",{children:"Courses:"})}),e.jsx(S,{spacing:1,children:r.courses.map(n=>e.jsxs(u,{sx:{p:1,border:"1px solid",borderColor:"divider",borderRadius:1},children:[e.jsx(s,{variant:"body2",fontWeight:"medium",children:n.courseTitle}),e.jsxs(S,{direction:"row",spacing:1,sx:{mt:1},children:[e.jsx(C,{label:n.enrollment.STATUS,color:U(n.enrollment.STATUS),size:"small"}),n.enrollment.FINAL_GRADE&&e.jsx(C,{label:`${n.enrollment.FINAL_GRADE}%`,color:"primary",size:"small"}),e.jsx(O,{title:"Remove from course",children:e.jsx(_,{size:"small",color:"error",onClick:()=>B(r.UID,n.courseId),children:e.jsx($,{icon:"eva:close-fill"})})})]})]},n.courseId))})]})]})})},r.UID)})})]})]})]})}export{J as default};
