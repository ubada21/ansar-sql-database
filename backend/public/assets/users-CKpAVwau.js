import{j as e,a0 as ie,A as ce,B as f,Q as m,a4 as X,d as F,a5 as J,a1 as Q,n as de,b as ue,R as H,a6 as N,a7 as Z,a3 as B,I as y,a8 as Y,a9 as ee,r as u,K as he,N as xe,O as me,J as pe,aa as O,ab as je,G as P,w as $,p as L,k as U,T as g,x as ge,U as fe,y as be,ac as ve,e as Ce}from"./index-B2Cbre3s.js";import{F as ye,a as z,c as G}from"./filters-result-CYn8xtm2.js";import{u as we,a as Se,o as De,s as v}from"./zod-B-PeTbPC.js";import{t as A}from"./index-Dc__PeCz.js";import{F as Te,a as C}from"./form-provider-B-IQRdhN.js";import{D as ke,a as Re}from"./DialogTitle-B15UQjHU.js";import{D as Ae}from"./DialogActions-DGZA522y.js";import{C as se,a as te,u as Ue,g as Ee,r as Fe,T as Ie,b as Pe,c as Le,e as Ne,d as Be,f as Me}from"./table-pagination-custom-eF1TfK0R.js";import{C as Oe}from"./custom-breadcrumbs-CnqUOG1T.js";import{T as $e,a as k,b as ze,c as Ge}from"./TableHead-CEhwUuF5.js";import{S as Qe}from"./Stack-B6VeFILc.js";import{T as He}from"./TextField-s5sflpap.js";import{G as E}from"./Grid-BRF5KrpT.js";import"./TableSortLabel-C2GiVA1D.js";const Ve=De({name:v().min(1,{message:"Name is required!"}),email:v().min(1,{message:"Email is required!"}).email({message:"Email must be a valid email address!"}),phoneNumber:v().optional(),country:v().optional(),state:v().optional(),city:v().optional(),address:v().optional(),zipCode:v().optional(),company:v().optional(),role:v().optional(),status:v().optional()});function We({currentUser:s,open:o,onClose:a}){const c={name:"",email:"",phoneNumber:"",address:"",country:"",state:"",city:"",zipCode:"",status:"",company:"",role:""},n=we({mode:"all",resolver:Se(Ve),defaultValues:c,values:s}),{reset:i,handleSubmit:d,formState:{isSubmitting:p}}=n,l=d(async r=>{const h=new Promise(j=>setTimeout(j,1e3));try{i(),a(),A.promise(h,{loading:"Loading...",success:"Update success!",error:"Update error!"}),await h,console.info("DATA",r)}catch(j){console.error(j)}});return e.jsx(ie,{fullWidth:!0,maxWidth:!1,open:o,onClose:a,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{maxWidth:720}},children:e.jsxs(Te,{methods:n,onSubmit:l,children:[e.jsx(ke,{children:"Quick Update"}),e.jsxs(Re,{dividers:!0,sx:{pt:3},children:[e.jsx(ce,{severity:"info",sx:{mb:3},children:"Update the information below and we will update you when changes are made."}),e.jsxs(f,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[e.jsx(C.Text,{name:"name",label:"Full Name"}),e.jsx(C.Text,{name:"email",label:"Email Address"}),e.jsx(C.Text,{name:"phoneNumber",label:"Phone Number"}),e.jsx(C.Text,{name:"address",label:"Address"}),e.jsx(C.Text,{name:"country",label:"Country"}),e.jsx(C.Text,{name:"state",label:"State/Region"}),e.jsx(C.Text,{name:"city",label:"City"}),e.jsx(C.Text,{name:"zipCode",label:"Zip/Code"}),e.jsx(C.Text,{name:"company",label:"Company"}),e.jsxs(C.Select,{name:"role",label:"Role",children:[e.jsx(m,{value:"leader",children:" Leader "}),e.jsx(m,{value:"hr",children:" HR "}),e.jsx(m,{value:"ui designer",children:" UI Designer "}),e.jsx(m,{value:"ux designer",children:" UX Designer "}),e.jsx(m,{value:"ui/ux designer",children:" UI/UX Designer "}),e.jsx(m,{value:"project manager",children:" Project Manager "}),e.jsx(m,{value:"backend developer",children:" Backend Developer "}),e.jsx(m,{value:"full stack designer",children:" Full Stack Designer "}),e.jsx(m,{value:"front end developer",children:" Front End Developer "}),e.jsx(m,{value:"full stack developer",children:" Full Stack Developer "})]}),e.jsx(C.Select,{name:"status",label:"Status",children:X.map(r=>e.jsx(m,{value:r.value,children:r.label},r.value))})]})]}),e.jsxs(Ae,{children:[e.jsx(F,{variant:"outlined",color:"inherit",onClick:a,children:"Cancel"}),e.jsx(F,{type:"submit",variant:"contained",disabled:p,children:"Update"})]})]})})}function _e({row:s,userRoles:o,selected:a,editHref:c,onSelectRow:n,onDeleteRow:i}){const d=J(),p=Q(),l=Q(),r=()=>e.jsx(We,{currentUser:s,open:l.value,onClose:l.onFalse}),h=()=>e.jsx(Y,{open:d.open,anchorEl:d.anchorEl,onClose:d.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(ee,{children:[e.jsx("li",{children:e.jsxs(m,{component:H,href:c,onClick:()=>d.onClose(),children:[e.jsx(y,{icon:"solar:pen-bold"}),"Edit"]})}),e.jsxs(m,{onClick:()=>{p.onTrue(),d.onClose()},sx:{color:"error.main"},children:[e.jsx(y,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})}),j=()=>e.jsx(te,{open:p.value,onClose:p.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(F,{variant:"contained",color:"error",onClick:i,children:"Delete"})});return e.jsxs(e.Fragment,{children:[e.jsxs($e,{hover:!0,selected:a,"aria-checked":a,tabIndex:-1,children:[e.jsx(k,{padding:"checkbox",children:e.jsx(se,{checked:a,onClick:n,slotProps:{input:{id:`${s.UID}-checkbox`,"aria-label":`${s.UID} checkbox`}}})}),e.jsx(k,{children:e.jsxs(f,{sx:{gap:2,display:"flex",alignItems:"center"},children:[e.jsx(de,{alt:`${s.FIRSTNAME} ${s.LASTNAME}`}),e.jsxs(Qe,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsxs(ue,{component:H,href:c,color:"inherit",sx:{cursor:"pointer"},children:[s.FIRSTNAME," ",s.LASTNAME]}),e.jsxs(f,{component:"span",sx:{color:"text.disabled"},children:["ID: ",s.UID]})]})]})}),e.jsx(k,{sx:{whiteSpace:"nowrap"},children:s.EMAIL}),e.jsx(k,{sx:{whiteSpace:"nowrap"},children:s.PHONENUMBER||"N/A"}),e.jsx(k,{sx:{whiteSpace:"nowrap"},children:o.length>0?e.jsx(f,{sx:{display:"flex",flexDirection:"column",gap:.5},children:o.map(w=>e.jsx(N,{variant:"soft",color:w.ROLENAME==="admin"?"primary":"default",sx:{fontSize:"0.75rem"},children:w.ROLENAME},w.ROLEID))}):e.jsx(N,{variant:"soft",color:"default",sx:{fontSize:"0.75rem"},children:"No roles"})}),e.jsx(k,{children:e.jsx(N,{variant:"soft",color:"success",children:"Active"})}),e.jsx(k,{children:e.jsxs(f,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(Z,{title:"Quick edit",placement:"top",arrow:!0,children:e.jsx(B,{color:l.value?"inherit":"default",onClick:l.onTrue,children:e.jsx(y,{icon:"solar:pen-bold"})})}),e.jsx(B,{color:d.open?"inherit":"default",onClick:d.onOpen,children:e.jsx(y,{icon:"eva:more-vertical-fill"})})]})})]}),r(),h(),j()]})}function qe({filters:s,options:o,onResetPage:a}){const c=J(),{state:n,setState:i}=s,d=u.useCallback(r=>{a(),i({name:r.target.value})},[a,i]),p=u.useCallback(r=>{const h=typeof r.target.value=="string"?r.target.value.split(","):r.target.value;a(),i({role:h})},[a,i]),l=()=>e.jsx(Y,{open:c.open,anchorEl:c.anchorEl,onClose:c.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(ee,{children:[e.jsxs(m,{onClick:()=>c.onClose(),children:[e.jsx(y,{icon:"solar:printer-minimalistic-bold"}),"Print"]}),e.jsxs(m,{onClick:()=>c.onClose(),children:[e.jsx(y,{icon:"solar:import-bold"}),"Import"]}),e.jsxs(m,{onClick:()=>c.onClose(),children:[e.jsx(y,{icon:"solar:export-bold"}),"Export"]})]})});return e.jsxs(e.Fragment,{children:[e.jsxs(f,{sx:{p:2.5,gap:2,display:"flex",pr:{xs:2.5,md:1},flexDirection:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"}},children:[e.jsxs(he,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[e.jsx(xe,{htmlFor:"filter-role-select",children:"Role"}),e.jsx(me,{multiple:!0,label:"Role",value:n.role,onChange:p,renderValue:r=>r.map(h=>h).join(", "),inputProps:{id:"filter-role-select"},MenuProps:{PaperProps:{sx:{maxHeight:240}}},children:o.roles.map(r=>e.jsxs(m,{value:r,children:[e.jsx(se,{disableRipple:!0,size:"small",checked:n.role.includes(r),slotProps:{input:{id:`${r}-checkbox`}}}),r]},r))})]}),e.jsxs(f,{sx:{gap:2,width:1,flexGrow:1,display:"flex",alignItems:"center"},children:[e.jsx(He,{fullWidth:!0,value:n.name,onChange:d,placeholder:"Search...",slotProps:{input:{startAdornment:e.jsx(pe,{position:"start",children:e.jsx(y,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}}),e.jsx(B,{onClick:c.onOpen,children:e.jsx(y,{icon:"eva:more-vertical-fill"})})]})]}),l()]})}function Ke({filters:s,onResetPage:o,totalResults:a,sx:c}){const{state:n,setState:i,resetState:d}=s,p=u.useCallback(()=>{o(),i({name:""})},[o,i]),l=u.useCallback(()=>{o(),i({status:"all"})},[o,i]),r=u.useCallback(j=>{const w=n.role.filter(S=>S!==j);o(),i({role:w})},[o,i,n.role]),h=u.useCallback(()=>{o(),d()},[o,d]);return e.jsxs(ye,{totalResults:a,onReset:h,sx:c,children:[e.jsx(z,{label:"Status:",isShow:n.status!=="all",children:e.jsx(O,{...G,label:n.status,onDelete:l,sx:{textTransform:"capitalize"}})}),e.jsx(z,{label:"Role:",isShow:!!n.role.length,children:n.role.map(j=>u.createElement(O,{...G,key:j,label:j,onDelete:()=>r(j)}))}),e.jsx(z,{label:"Keyword:",isShow:!!n.name,children:e.jsx(O,{...G,label:n.name,onDelete:p})})]})}const Xe=[{value:"all",label:"All"},...X],Je=[{id:"name",label:"Name"},{id:"email",label:"Email",width:220},{id:"phoneNumber",label:"Phone number",width:180},{id:"roles",label:"Roles",width:200},{id:"status",label:"Status",width:100},{id:"",width:88}];function Ze(){const s=Ue(),o=Q(),[a,c]=u.useState([]),[n,i]=u.useState({}),[d,p]=u.useState(!0),[l,r]=u.useState(""),[h,j]=u.useState([]),w=je({name:"",role:[],status:"all"}),{state:S,setState:V}=w,W=u.useCallback(async()=>{try{p(!0);const t=await P.get("/users"),x=t.data;if(t.status===200){const R=x.users||[];c(R);const D={};for(const T of R)try{const I=await P.get(`/users/${T.UID}/roles`);if(I.status===200){const oe=I.data;D[T.UID]=oe.roles||[]}else D[T.UID]=[]}catch(I){console.error(`Error fetching roles for user ${T.UID}:`,I),D[T.UID]=[]}i(D)}else r(x.message||"Failed to fetch users")}catch(t){console.error("Error fetching users:",t),r("Failed to fetch users")}finally{p(!1)}},[]),_=u.useCallback(async()=>{try{const t=await P.get("/roles");if(t.status===200){const x=t.data;j(x.roles||[])}}catch(t){console.error("Error fetching roles:",t)}},[]);u.useEffect(()=>{W(),_()},[W,_]);const b=Ye({inputData:a,comparator:Ee(s.order,s.orderBy),filters:S,userRoles:n}),q=Fe(b,s.page,s.rowsPerPage),K=!!S.name||S.role.length>0||S.status!=="all",re=!b.length&&K||!b.length,M=u.useCallback(async t=>{try{const x=await P.delete(`/users/${t}`);if(x.status===200){const R=a.filter(T=>T.UID!==t);c(R);const D={...n};delete D[t],i(D),A.success("Delete success!"),s.onUpdatePageDeleteRow(q.length)}else{const R=x.data;A.error(R.message||"Failed to delete user")}}catch(x){console.error("Error deleting user:",x),A.error("Failed to delete user")}},[q.length,s,a,n]),le=u.useCallback(async()=>{try{for(const t of s.selected)await M(t);A.success(`${s.selected.length} users deleted successfully!`)}catch(t){console.error("Error deleting selected users:",t),A.error("Failed to delete some users")}},[s.selected,M]),ae=u.useCallback((t,x)=>{s.onResetPage(),V({status:x})},[V,s]),ne=()=>e.jsx(te,{open:o.value,onClose:o.onFalse,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",s.selected.length," "]})," items?"]}),action:e.jsx(F,{variant:"contained",color:"error",onClick:()=>{le(),o.onFalse()},children:"Delete"})});return d?e.jsx($,{children:e.jsx(f,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:400},children:e.jsx(f,{children:"Loading users..."})})}):l?e.jsx($,{children:e.jsx(f,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:400},children:e.jsx(f,{sx:{color:"error.main"},children:l})})}):e.jsxs(e.Fragment,{children:[e.jsxs($,{children:[e.jsx(Oe,{heading:"Users List",links:[{name:"Dashboard",href:L.dashboard.root},{name:"Users",href:L.dashboard.users},{name:"List"}],action:e.jsx(F,{component:H,href:L.dashboard.user.new,variant:"contained",startIcon:e.jsx(y,{icon:"mingcute:add-line"}),children:"Add user"}),sx:{mb:{xs:3,md:5}}}),e.jsxs(E,{container:!0,spacing:3,sx:{mb:3},children:[e.jsx(E,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(U,{sx:{p:3,textAlign:"center"},children:[e.jsx(g,{variant:"h4",color:"primary.main",gutterBottom:!0,children:a.length}),e.jsx(g,{variant:"h6",gutterBottom:!0,children:"Total Users"}),e.jsx(g,{variant:"body2",color:"text.secondary",children:"All registered users"})]})}),e.jsx(E,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(U,{sx:{p:3,textAlign:"center"},children:[e.jsx(g,{variant:"h4",color:"success.main",gutterBottom:!0,children:a.filter(t=>t.status==="active").length}),e.jsx(g,{variant:"h6",gutterBottom:!0,children:"Active Users"}),e.jsx(g,{variant:"body2",color:"text.secondary",children:"Currently active"})]})}),e.jsx(E,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(U,{sx:{p:3,textAlign:"center"},children:[e.jsx(g,{variant:"h4",color:"warning.main",gutterBottom:!0,children:a.filter(t=>t.status==="pending").length}),e.jsx(g,{variant:"h6",gutterBottom:!0,children:"Pending Users"}),e.jsx(g,{variant:"body2",color:"text.secondary",children:"Awaiting approval"})]})}),e.jsx(E,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(U,{sx:{p:3,textAlign:"center"},children:[e.jsx(g,{variant:"h4",color:"error.main",gutterBottom:!0,children:a.filter(t=>t.status==="banned").length}),e.jsx(g,{variant:"h6",gutterBottom:!0,children:"Banned Users"}),e.jsx(g,{variant:"body2",color:"text.secondary",children:"Suspended accounts"})]})})]}),e.jsxs(U,{children:[e.jsx(ge,{value:S.status,onChange:ae,sx:[t=>({px:{md:2.5},boxShadow:`inset 0 -2px 0 0 ${fe(t.vars.palette.grey["500Channel"],.08)}`})],children:Xe.map(t=>e.jsx(be,{iconPosition:"end",value:t.value,label:t.label,icon:e.jsx(N,{variant:(t.value==="all"||t.value===S.status)&&"filled"||"soft",color:t.value==="active"&&"success"||t.value==="pending"&&"warning"||t.value==="banned"&&"error"||"default",children:t.value==="all"?a.length:a.filter(x=>x.status===t.value).length})},t.value))}),e.jsx(qe,{filters:w,onResetPage:s.onResetPage,options:{roles:h.map(t=>t.ROLENAME)}}),K&&e.jsx(Ke,{filters:w,totalResults:b.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(f,{sx:{position:"relative"},children:[e.jsx(Ie,{dense:s.dense,numSelected:s.selected.length,rowCount:b.length,onSelectAllRows:t=>s.onSelectAllRows(t,b.map(x=>x.UID)),action:e.jsx(Z,{title:"Delete",children:e.jsx(B,{color:"primary",onClick:o.onTrue,children:e.jsx(y,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(ve,{children:e.jsxs(ze,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Pe,{order:s.order,orderBy:s.orderBy,headCells:Je,rowCount:b.length,numSelected:s.selected.length,onSort:s.onSort,onSelectAllRows:t=>s.onSelectAllRows(t,b.map(x=>x.UID))}),e.jsxs(Ge,{children:[b.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(t=>e.jsx(_e,{row:t,userRoles:n[t.UID]||[],selected:s.selected.includes(t.UID),onSelectRow:()=>s.onSelectRow(t.UID),onDeleteRow:()=>M(t.UID),editHref:L.dashboard.users},t.UID)),e.jsx(Le,{height:s.dense?56:76,emptyRows:Ne(s.page,s.rowsPerPage,b.length)}),e.jsx(Be,{notFound:re})]})]})})]}),e.jsx(Me,{page:s.page,dense:s.dense,count:b.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})]}),ne()]})}function Ye({inputData:s,comparator:o,filters:a,userRoles:c}){const{name:n,status:i,role:d}=a,p=s.map((l,r)=>[l,r]);return p.sort((l,r)=>{const h=o(l[0],r[0]);return h!==0?h:l[1]-r[1]}),s=p.map(l=>l[0]),n&&(s=s.filter(l=>`${l.FIRSTNAME} ${l.LASTNAME}`.toLowerCase().includes(n.toLowerCase())||l.EMAIL.toLowerCase().includes(n.toLowerCase()))),i!=="all"&&(s=s.filter(l=>l.status===i)),d.length&&(s=s.filter(l=>{const r=c[l.UID]||[];return d.some(h=>r.some(j=>j.ROLENAME===h))})),s}const es={title:`Users | Dashboard - ${Ce.appName}`};function ps(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:es.title}),e.jsx(Ze,{})]})}export{ps as default};
