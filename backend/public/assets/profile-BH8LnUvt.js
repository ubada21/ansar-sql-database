import{z,E as k,r as h,G as b,W as C,j as t,e as $,w as S,p as v,k as c,B as u,n as H,T as n,aa as m,ad as q}from"./index-B2Cbre3s.js";import{C as J}from"./custom-breadcrumbs-CnqUOG1T.js";import{G as i}from"./Grid-BRF5KrpT.js";import{T as K}from"./TableContainer-DTSdEQoF.js";import{b as Q,d as V,T as I,a as l,c as X}from"./TableHead-CEhwUuF5.js";import{S as R}from"./Stack-B6VeFILc.js";const w={title:`My Profile | Student Dashboard - ${$.appName}`};function ot(){var f,A;const B=z(),{authenticated:j,user:r}=k(),[d,L]=h.useState([]),[N,g]=h.useState(!0),D=h.useCallback(async()=>{if(r!=null&&r.UID)try{g(!0);const o=(await b.get(C.courses.list)).data.courses||[],s=[];for(const a of o)try{const y=((await b.get(C.courses.students(a.COURSEID))).data.students||[]).find(W=>W.UID===r.UID);y&&s.push({...a,enrollment:y})}catch(T){console.error(`Error fetching enrollment for course ${a.COURSEID}:`,T)}L(s)}catch(e){console.error("Error fetching enrolled courses:",e)}finally{g(!1)}},[r==null?void 0:r.UID]);if(h.useEffect(()=>{j&&(r!=null&&r.UID)&&D()},[j,r==null?void 0:r.UID,D]),!j)return B.push("/login"),null;const p=e=>{const o=new Date,s=new Date(e.STARTDATE),a=new Date(e.ENDDATE);return s>o?{label:"Upcoming",color:"info"}:s<=o&&a>=o?{label:"Ongoing",color:"success"}:{label:"Completed",color:"default"}},x=e=>new Date(e).toLocaleDateString(),G=()=>{const e=d.filter(s=>s.enrollment.FINAL_GRADE);return e.length===0?0:(e.reduce((s,a)=>s+a.enrollment.FINAL_GRADE,0)/e.length).toFixed(2)},F=()=>d.filter(e=>new Date(e.ENDDATE)<new Date),U=()=>d.filter(e=>{const o=new Date,s=new Date(e.STARTDATE),a=new Date(e.ENDDATE);return s<=o&&a>=o}),O=()=>d.filter(e=>new Date(e.STARTDATE)>new Date);if(N)return t.jsxs(t.Fragment,{children:[t.jsx("title",{children:w.title}),t.jsx(S,{maxWidth:"xl",children:t.jsx("div",{children:"Loading your profile..."})})]});const P=G(),E=F(),M=U(),_=O();return t.jsxs(t.Fragment,{children:[t.jsx("title",{children:w.title}),t.jsxs(S,{maxWidth:"xl",children:[t.jsx(J,{heading:"My Profile",links:[{name:"Dashboard",href:v.dashboard.root},{name:"Student",href:v.dashboard.student.courses},{name:"My Profile"}],sx:{mb:{xs:3,md:5}}}),t.jsxs(i,{container:!0,spacing:3,children:[t.jsx(i,{item:!0,xs:12,children:t.jsx(c,{sx:{p:3},children:t.jsxs(u,{sx:{display:"flex",alignItems:"center",gap:3,flexWrap:"wrap"},children:[t.jsx(H,{sx:{width:80,height:80,bgcolor:"primary.main"},children:t.jsxs(n,{variant:"h4",children:[(f=r==null?void 0:r.FIRSTNAME)==null?void 0:f[0],(A=r==null?void 0:r.LASTNAME)==null?void 0:A[0]]})}),t.jsxs(u,{sx:{flex:1},children:[t.jsxs(n,{variant:"h4",gutterBottom:!0,children:[r==null?void 0:r.FIRSTNAME," ",r==null?void 0:r.LASTNAME]}),t.jsxs(n,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:["Student ID: ",r==null?void 0:r.UID]}),t.jsxs(n,{variant:"body1",color:"text.secondary",gutterBottom:!0,children:["Email: ",r==null?void 0:r.EMAIL]}),t.jsx(m,{label:"Student",color:"success",size:"small",sx:{mt:1}})]})]})})}),t.jsx(i,{item:!0,xs:12,md:3,children:t.jsxs(c,{sx:{p:3,textAlign:"center"},children:[t.jsx(n,{variant:"h4",color:"primary",gutterBottom:!0,children:P}),t.jsx(n,{variant:"h6",gutterBottom:!0,children:"GPA"}),t.jsxs(n,{variant:"body2",color:"text.secondary",children:[E.filter(e=>e.enrollment.FINAL_GRADE).length," graded courses"]})]})}),t.jsx(i,{item:!0,xs:12,md:3,children:t.jsxs(c,{sx:{p:3,textAlign:"center"},children:[t.jsx(n,{variant:"h4",color:"success.main",gutterBottom:!0,children:E.length}),t.jsx(n,{variant:"h6",gutterBottom:!0,children:"Completed"}),t.jsx(n,{variant:"body2",color:"text.secondary",children:"Courses finished"})]})}),t.jsx(i,{item:!0,xs:12,md:3,children:t.jsxs(c,{sx:{p:3,textAlign:"center"},children:[t.jsx(n,{variant:"h4",color:"info.main",gutterBottom:!0,children:M.length}),t.jsx(n,{variant:"h6",gutterBottom:!0,children:"Ongoing"}),t.jsx(n,{variant:"body2",color:"text.secondary",children:"Currently enrolled"})]})}),t.jsx(i,{item:!0,xs:12,md:3,children:t.jsxs(c,{sx:{p:3,textAlign:"center"},children:[t.jsx(n,{variant:"h4",color:"warning.main",gutterBottom:!0,children:_.length}),t.jsx(n,{variant:"h6",gutterBottom:!0,children:"Upcoming"}),t.jsx(n,{variant:"body2",color:"text.secondary",children:"Future courses"})]})}),t.jsx(i,{item:!0,xs:12,children:t.jsxs(c,{sx:{p:3},children:[t.jsx(n,{variant:"h6",gutterBottom:!0,children:"Enrollment History"}),t.jsx(K,{component:q,variant:"outlined",children:t.jsxs(Q,{children:[t.jsx(V,{children:t.jsxs(I,{children:[t.jsx(l,{children:"Course"}),t.jsx(l,{children:"Location"}),t.jsx(l,{children:"Status"}),t.jsx(l,{children:"Enrollment Date"}),t.jsx(l,{children:"Start Date"}),t.jsx(l,{children:"End Date"}),t.jsx(l,{children:"Final Grade"})]})}),t.jsx(X,{children:d.map(e=>{const o=p(e),s=e.enrollment.FINAL_GRADE;return t.jsxs(I,{children:[t.jsx(l,{children:t.jsx(n,{variant:"subtitle2",children:e.TITLE})}),t.jsx(l,{children:e.LOCATION}),t.jsx(l,{children:t.jsx(m,{label:o.label,color:o.color,size:"small"})}),t.jsx(l,{children:x(e.enrollment.ENROLL_DATE)}),t.jsx(l,{children:x(e.STARTDATE)}),t.jsx(l,{children:x(e.ENDDATE)}),t.jsx(l,{children:s?`${s}%`:"Pending"})]},e.COURSEID)})})]})})]})}),t.jsx(i,{item:!0,xs:12,children:t.jsx(n,{variant:"h6",gutterBottom:!0,children:"Course Progress"})}),d.map(e=>{const o=p(e),s=e.enrollment.FINAL_GRADE;return t.jsx(i,{item:!0,xs:12,md:6,lg:4,children:t.jsx(c,{sx:{p:3,height:"100%"},children:t.jsxs(R,{spacing:2,children:[t.jsxs(u,{children:[t.jsx(n,{variant:"h6",gutterBottom:!0,children:e.TITLE}),t.jsxs(R,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:[t.jsx(m,{label:o.label,color:o.color,size:"small"}),s&&t.jsx(m,{label:`${s}%`,color:"primary",size:"small"})]})]}),t.jsxs(u,{children:[t.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[t.jsx("strong",{children:"Location:"})," ",e.LOCATION]}),t.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[t.jsx("strong",{children:"Enrolled:"})," ",x(e.enrollment.ENROLL_DATE)]}),t.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[t.jsx("strong",{children:"Duration:"})," ",x(e.STARTDATE)," - ",x(e.ENDDATE)]}),t.jsxs(n,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[t.jsx("strong",{children:"Status:"})," ",e.enrollment.STATUS]}),s&&t.jsxs(n,{variant:"body2",color:"text.secondary",children:[t.jsx("strong",{children:"Final Grade:"})," ",s,"%"]})]})]})})},e.COURSEID)})]})]})]})}export{ot as default};
