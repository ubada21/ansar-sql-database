import{z as Re,E as Le,r as h,G as L,O as G,j as e,e as Ge,w as K,p as Q,k as g,T as s,ae as Z,aM as Fe,B as p,N as F,I as D,ab as U,aO as J,a8 as X,aZ as Ue,Q as Oe,n as Me,K as Be,d as ee}from"./index-B-O2wvL4.js";import{C as _e}from"./custom-breadcrumbs-C2AuKEDp.js";import{G as f}from"./Grid-Ba55pw_4.js";import{T as re}from"./TableContainer-BkKYrVIR.js";import{b as te,d as ae,T as b,a as o,c as se}from"./TableHead-CcFJ9gr-.js";import{T as O}from"./TextField-BfDbW8wr.js";import{T as C}from"./TableSortLabel-CGO5UpHm.js";import{D as ke,a as We}from"./DialogTitle-w8z7uk1s.js";import{D as $e}from"./DialogActions-DZ5SCz5y.js";const ne={title:`Grade Management | Instructor Dashboard - ${Ge.appName}`};function Je(){const oe=Re(),{authenticated:I,user:l}=Le(),[M,ie]=h.useState([]),[A,B]=h.useState([]),[le,_]=h.useState(!0),[ce,k]=h.useState(!1),[x,W]=h.useState(null),[E,T]=h.useState(""),[N,$]=h.useState(!1),[P,de]=h.useState(null),[j,xe]=h.useState("asc"),[u,he]=h.useState(""),[v,ue]=h.useState(""),[y,me]=h.useState("all"),z=h.useCallback(async()=>{if(l!=null&&l.UID)try{_(!0);const a=((await L.get(G.courses.list)).data.courses||[]).filter(n=>{const d=n.INSTRUCTOR_IDS?n.INSTRUCTOR_IDS.split(","):[],t=n.INSTRUCTOR_NAMES?n.INSTRUCTOR_NAMES.split(","):[],m=`${l.FIRSTNAME} ${l.LASTNAME}`;return d.includes(l.UID.toString())||t.includes(m)});ie(a);const c=[];for(const n of a)try{((await L.get(G.courses.students(n.COURSEID))).data.students||[]).forEach(m=>{c.push({...m,courseId:n.COURSEID,courseTitle:n.TITLE,courseLocation:n.LOCATION,courseStartDate:n.STARTDATE,courseEndDate:n.ENDDATE})})}catch(d){console.error(`Error fetching students for course ${n.COURSEID}:`,d)}B(c)}catch(r){console.error("Error fetching teaching courses and students:",r)}finally{_(!1)}},[l==null?void 0:l.UID,l==null?void 0:l.FIRSTNAME,l==null?void 0:l.LASTNAME]);if(h.useEffect(()=>{I&&(l!=null&&l.UID)&&z()},[I,l==null?void 0:l.UID,z]),!I)return oe.push("/login"),null;const pe=r=>new Date(r).toLocaleDateString(),Y=r=>r?r>=90?"success":r>=80?"primary":r>=70?"warning":"error":"default",je=r=>r?r>=90?"A":r>=80?"B":r>=70?"C":r>=60?"D":"F":"N/A",ge=r=>{const i=new Date,a=new Date(r.STARTDATE),c=new Date(r.ENDDATE);return a>i?{label:"Upcoming",color:"info"}:a<=i&&c>=i?{label:"Ongoing",color:"success"}:{label:"Completed",color:"default"}},Ae=r=>{switch(r==null?void 0:r.toLowerCase()){case"active":return"success";case"completed":return"primary";case"withdrawn":return"warning";case"failed":return"error";default:return"default"}},w=r=>{de(P===r?null:r)},S=(r,i)=>{xe(u===i&&j==="asc"?"desc":"asc"),he(i)},fe=r=>{ue(r.target.value)},Se=r=>{me(r.target.value)},be=r=>{let i=r;return v&&(i=i.filter(a=>`${a.FIRSTNAME} ${a.LASTNAME}`.toLowerCase().includes(v.toLowerCase())||a.EMAIL.toLowerCase().includes(v.toLowerCase()))),y!=="all"&&(i=i.filter(a=>a.STATUS.toLowerCase()===y.toLowerCase())),u&&i.sort((a,c)=>{let n,d;switch(u){case"name":n=`${a.FIRSTNAME} ${a.LASTNAME}`.toLowerCase(),d=`${c.FIRSTNAME} ${c.LASTNAME}`.toLowerCase();break;case"email":n=a.EMAIL.toLowerCase(),d=c.EMAIL.toLowerCase();break;case"status":n=a.STATUS.toLowerCase(),d=c.STATUS.toLowerCase();break;case"grade":n=a.FINAL_GRADE||0,d=c.FINAL_GRADE||0;break;case"enrollDate":n=new Date(a.ENROLL_DATE),d=new Date(c.ENROLL_DATE);break;default:return 0}return j==="desc"?d>n?1:-1:n>d?1:-1}),i},Ce=()=>{const r=A.filter(a=>a.FINAL_GRADE!=null&&!isNaN(a.FINAL_GRADE));return r.length===0?0:(r.reduce((a,c)=>a+parseFloat(c.FINAL_GRADE),0)/r.length).toFixed(2)},Ee=()=>A.filter(r=>r.FINAL_GRADE!=null&&!isNaN(r.FINAL_GRADE)),ve=()=>A.filter(r=>r.FINAL_GRADE==null||isNaN(r.FINAL_GRADE)),De=r=>{W(r),T(r.FINAL_GRADE?r.FINAL_GRADE.toString():""),k(!0)},R=()=>{k(!1),W(null),T("")},Ie=async()=>{if(!x||!E)return;const r=parseFloat(E);if(isNaN(r)||r<0||r>100){alert("Please enter a valid grade between 0 and 100");return}try{$(!0),await L.patch(G.courses.updateEnrollment(x.courseId,x.UID),{FINAL_GRADE:r}),B(i=>i.map(a=>a.UID===x.UID&&a.courseId===x.courseId?{...a,FINAL_GRADE:r}:a)),R()}catch(i){console.error("Error updating grade:",i),alert("Failed to update grade. Please try again.")}finally{$(!1)}};if(le)return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:ne.title}),e.jsx(K,{maxWidth:"xl",children:e.jsx("div",{children:"Loading grade management..."})})]});const Te=Ce(),Ne=Ee(),ye=ve();return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:ne.title}),e.jsxs(K,{maxWidth:"xl",children:[e.jsx(_e,{heading:"Grade Management",links:[{name:"Dashboard",href:Q.dashboard.root},{name:"Instructor",href:Q.dashboard.instructor.courses},{name:"Grade Management"}],sx:{mb:{xs:3,md:5}}}),M.length===0?e.jsxs(g,{sx:{p:4,textAlign:"center"},children:[e.jsx(s,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"You are not assigned to teach any courses yet."}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Contact an administrator to assign you to courses."})]}):A.length===0?e.jsxs(g,{sx:{p:4,textAlign:"center"},children:[e.jsx(s,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No students are enrolled in your courses yet."}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Students will appear here once they enroll in your courses."})]}):e.jsxs(f,{container:!0,spacing:3,children:[e.jsx(f,{item:!0,xs:12,md:3,children:e.jsxs(g,{sx:{p:3,textAlign:"center",border:"1px solid #e0e0e0",borderRadius:2,boxShadow:"0 4px 12px rgba(0,0,0,0.1)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 24px rgba(0,0,0,0.15)",transform:"translateY(-4px)",borderColor:"primary.main"}},children:[e.jsx(s,{variant:"h4",color:"primary",gutterBottom:!0,children:Te}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Average Grade"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Across all students"})]})}),e.jsx(f,{item:!0,xs:12,md:3,children:e.jsxs(g,{sx:{p:3,textAlign:"center",border:"1px solid #e0e0e0",borderRadius:2,boxShadow:"0 4px 12px rgba(0,0,0,0.1)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 24px rgba(0,0,0,0.15)",transform:"translateY(-4px)",borderColor:"success.main"}},children:[e.jsx(s,{variant:"h4",color:"success.main",gutterBottom:!0,children:A.length}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Total Students"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Enrolled in courses"})]})}),e.jsx(f,{item:!0,xs:12,md:3,children:e.jsxs(g,{sx:{p:3,textAlign:"center",border:"1px solid #e0e0e0",borderRadius:2,boxShadow:"0 4px 12px rgba(0,0,0,0.1)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 24px rgba(0,0,0,0.15)",transform:"translateY(-4px)",borderColor:"info.main"}},children:[e.jsx(s,{variant:"h4",color:"info.main",gutterBottom:!0,children:Ne.length}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Graded Students"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"With final grades"})]})}),e.jsx(f,{item:!0,xs:12,md:3,children:e.jsxs(g,{sx:{p:3,textAlign:"center",border:"1px solid #e0e0e0",borderRadius:2,boxShadow:"0 4px 12px rgba(0,0,0,0.1)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 24px rgba(0,0,0,0.15)",transform:"translateY(-4px)",borderColor:"warning.main"}},children:[e.jsx(s,{variant:"h4",color:"warning.main",gutterBottom:!0,children:ye.length}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Pending Grades"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Need grading"})]})}),e.jsx(f,{item:!0,xs:12,children:e.jsxs(g,{sx:{p:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Course Grades Overview"}),e.jsx(re,{component:Z,variant:"outlined",sx:{minWidth:1200},children:e.jsxs(te,{children:[e.jsx(ae,{children:e.jsxs(b,{children:[e.jsx(o,{children:"Course"}),e.jsx(o,{children:"Status"}),e.jsx(o,{children:"Students"}),e.jsx(o,{children:"Class Average"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(se,{children:M.map(r=>{const i=ge(r),a=A.filter(t=>t.courseId===r.COURSEID),c=a.filter(t=>t.FINAL_GRADE!=null&&!isNaN(t.FINAL_GRADE)),n=c.length>0?(c.reduce((t,m)=>t+parseFloat(m.FINAL_GRADE),0)/c.length).toFixed(2):0,d=P===r.COURSEID;return e.jsxs(Fe.Fragment,{children:[e.jsxs(b,{sx:{cursor:"pointer","&:hover":{backgroundColor:"action.hover"}},onClick:()=>w(r.COURSEID),children:[e.jsx(o,{children:e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(F,{size:"small",onClick:t=>{t.stopPropagation(),w(r.COURSEID)},children:e.jsx(D,{icon:d?"eva:arrow-ios-downward-fill":"eva:arrow-ios-forward-fill"})}),e.jsxs(p,{children:[e.jsx(s,{variant:"subtitle2",children:r.TITLE}),e.jsx(s,{variant:"body2",color:"text.secondary",children:r.LOCATION})]})]})}),e.jsx(o,{children:e.jsx(U,{label:i.label,color:i.color,size:"small"})}),e.jsx(o,{children:e.jsxs(s,{variant:"body2",children:[a.length," students"]})}),e.jsx(o,{children:n>0?e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(s,{variant:"body2",children:[n,"%"]}),e.jsx(J,{variant:"determinate",value:parseFloat(n),color:Y(n),sx:{width:60,height:6,borderRadius:3}})]}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"No grades yet"})}),e.jsx(o,{children:e.jsx(X,{title:d?"Collapse":"Expand",children:e.jsx(F,{size:"small",onClick:t=>{t.stopPropagation(),w(r.COURSEID)},children:e.jsx(D,{icon:d?"eva:arrow-ios-upward-fill":"eva:arrow-ios-downward-fill"})})})})]}),e.jsx(b,{children:e.jsx(o,{style:{paddingBottom:0,paddingTop:0},colSpan:5,children:e.jsx(Ue,{in:d,timeout:"auto",unmountOnExit:!0,children:e.jsxs(p,{sx:{margin:2},children:[e.jsxs(p,{sx:{mb:3,display:"flex",gap:2,flexWrap:"wrap"},children:[e.jsx(O,{placeholder:"Search by name or email...",value:v,onChange:fe,InputProps:{startAdornment:e.jsx(Oe,{position:"start",children:e.jsx(D,{icon:"eva:search-fill"})})},sx:{minWidth:300}}),e.jsxs(O,{select:!0,label:"Status",value:y,onChange:Se,sx:{minWidth:150},children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"active",children:"Active"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"withdrawn",children:"Withdrawn"}),e.jsx("option",{value:"failed",children:"Failed"})]})]}),e.jsx(re,{component:Z,variant:"outlined",sx:{maxHeight:600,width:"100%"},children:e.jsxs(te,{size:"small",stickyHeader:!0,children:[e.jsx(ae,{children:e.jsxs(b,{children:[e.jsx(o,{children:e.jsx(C,{active:u==="name",direction:u==="name"?j:"asc",onClick:t=>S(t,"name"),children:"Student"})}),e.jsx(o,{children:e.jsx(C,{active:u==="email",direction:u==="email"?j:"asc",onClick:t=>S(t,"email"),children:"Email"})}),e.jsx(o,{children:e.jsx(C,{active:u==="status",direction:u==="status"?j:"asc",onClick:t=>S(t,"status"),children:"Enrollment Status"})}),e.jsx(o,{children:e.jsx(C,{active:u==="grade",direction:u==="grade"?j:"asc",onClick:t=>S(t,"grade"),children:"Final Grade"})}),e.jsx(o,{children:"Letter Grade"}),e.jsx(o,{children:e.jsx(C,{active:u==="enrollDate",direction:u==="enrollDate"?j:"asc",onClick:t=>S(t,"enrollDate"),children:"Enrollment Date"})}),e.jsx(o,{children:"Actions"})]})}),e.jsx(se,{children:be(a).map(t=>{var V,q;const m=t.FINAL_GRADE,H=Y(m),we=je(m);return e.jsxs(b,{children:[e.jsx(o,{children:e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2},children:[e.jsx(Me,{sx:{width:32,height:32,bgcolor:"primary.main"},children:e.jsxs(s,{variant:"caption",children:[(V=t.FIRSTNAME)==null?void 0:V[0],(q=t.LASTNAME)==null?void 0:q[0]]})}),e.jsxs(p,{children:[e.jsxs(s,{variant:"subtitle2",children:[t.FIRSTNAME," ",t.LASTNAME]}),e.jsxs(s,{variant:"body2",color:"text.secondary",children:["ID: ",t.UID]})]})]})}),e.jsx(o,{children:e.jsx(s,{variant:"body2",children:t.EMAIL})}),e.jsx(o,{children:e.jsx(U,{label:t.STATUS,color:Ae(t.STATUS),size:"small"})}),e.jsx(o,{children:m?e.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(s,{variant:"body2",children:[m,"%"]}),e.jsx(J,{variant:"determinate",value:m,color:H,sx:{width:60,height:6,borderRadius:3}})]}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"Pending"})}),e.jsx(o,{children:m?e.jsx(U,{label:we,color:H,size:"small"}):e.jsx(s,{variant:"body2",color:"text.secondary",children:"N/A"})}),e.jsx(o,{children:pe(t.ENROLL_DATE)}),e.jsx(o,{children:e.jsx(X,{title:"Edit Grade",children:e.jsx(F,{size:"small",onClick:()=>De(t),color:"primary",children:e.jsx(D,{icon:"eva:edit-fill"})})})})]},`${t.UID}-${t.courseId}`)})})]})})]})})})})]},r.COURSEID)})})]})})]})})]}),e.jsxs(Be,{open:ce,onClose:R,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(ke,{children:["Update Grade for ",x==null?void 0:x.FIRSTNAME," ",x==null?void 0:x.LASTNAME]}),e.jsx(We,{children:e.jsxs(p,{sx:{pt:2},children:[e.jsxs(s,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Course: ",x==null?void 0:x.courseTitle]}),e.jsx(O,{fullWidth:!0,label:"Final Grade (%)",type:"number",value:E,onChange:r=>T(r.target.value),inputProps:{min:0,max:100,step:.1},sx:{mt:2}})]})}),e.jsxs($e,{children:[e.jsx(ee,{onClick:R,disabled:N,children:"Cancel"}),e.jsx(ee,{onClick:Ie,variant:"contained",disabled:N||!E,children:N?"Updating...":"Update Grade"})]})]})]})]})}export{Je as default};
