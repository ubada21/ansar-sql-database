import{z as te,E as re,r as c,J as E,K as G,j as e,e as se,w as _,p as w,k as h,T as r,a9 as ne,a5 as N,B as j,aO as ae,$ as oe,V as ie,I as le,W as ce,d as O}from"./index-FMbyiGBg.js";import{C as de}from"./custom-breadcrumbs-BYE_vmd6.js";import{G as u}from"./Grid-D0Xua7tw.js";import{T as he}from"./TableContainer-DFE7AUh4.js";import{b as ue,d as xe,T as M,a as o,c as ge}from"./TableHead-CZEiNHrS.js";import{S as W}from"./Stack-C1li3Gzt.js";import{D as je,a as me,b as Ae}from"./DialogTitle-BM4PjASd.js";import{T as pe}from"./TextField-qof22fmD.js";const $={title:`Grade Management | Instructor Dashboard - ${se.appName}`};function Se(){const P=te(),{authenticated:p,user:a}=re(),[T,k]=c.useState([]),[x,S]=c.useState([]),[z,b]=c.useState(!0),[V,v]=c.useState(!1),[l,C]=c.useState(null),[A,D]=c.useState(""),[y,R]=c.useState(!1),L=c.useCallback(async()=>{if(a!=null&&a.UID)try{b(!0);const n=((await E.get(G.courses.list)).data.courses||[]).filter(s=>{const g=s.INSTRUCTOR_IDS?s.INSTRUCTOR_IDS.split(","):[],U=s.INSTRUCTOR_NAMES?s.INSTRUCTOR_NAMES.split(","):[],f=`${a.FIRSTNAME} ${a.LASTNAME}`;return g.includes(a.UID.toString())||U.includes(f)});k(n);const d=[];for(const s of n)try{((await E.get(G.courses.students(s.COURSEID))).data.students||[]).forEach(f=>{d.push({...f,courseId:s.COURSEID,courseTitle:s.TITLE,courseLocation:s.LOCATION,courseStartDate:s.STARTDATE,courseEndDate:s.ENDDATE})})}catch(g){console.error(`Error fetching students for course ${s.COURSEID}:`,g)}S(d)}catch(t){console.error("Error fetching teaching courses and students:",t)}finally{b(!1)}},[a==null?void 0:a.UID,a==null?void 0:a.FIRSTNAME,a==null?void 0:a.LASTNAME]);if(c.useEffect(()=>{p&&(a!=null&&a.UID)&&L()},[p,a==null?void 0:a.UID,L]),!p)return P.push("/login"),null;const m=t=>new Date(t).toLocaleDateString(),F=t=>t?t>=90?"success":t>=80?"primary":t>=70?"warning":"error":"default",B=t=>t?t>=90?"A":t>=80?"B":t>=70?"C":t>=60?"D":"F":"N/A",H=t=>{switch(t==null?void 0:t.toLowerCase()){case"active":return"success";case"completed":return"primary";case"withdrawn":return"warning";case"failed":return"error";default:return"default"}},J=()=>{const t=x.filter(n=>n.FINAL_GRADE!=null&&!isNaN(n.FINAL_GRADE));return t.length===0?0:(t.reduce((n,d)=>n+parseFloat(d.FINAL_GRADE),0)/t.length).toFixed(2)},K=()=>x.filter(t=>t.FINAL_GRADE!=null&&!isNaN(t.FINAL_GRADE)),Y=()=>x.filter(t=>t.FINAL_GRADE==null||isNaN(t.FINAL_GRADE)),q=t=>{C(t),D(t.FINAL_GRADE?t.FINAL_GRADE.toString():""),v(!0)},I=()=>{v(!1),C(null),D("")},Q=async()=>{if(!l||!A)return;const t=parseFloat(A);if(isNaN(t)||t<0||t>100){alert("Please enter a valid grade between 0 and 100");return}try{R(!0),await E.patch(G.courses.updateEnrollment(l.courseId,l.UID),{FINAL_GRADE:t}),S(i=>i.map(n=>n.UID===l.UID&&n.courseId===l.courseId?{...n,FINAL_GRADE:t}:n)),I()}catch(i){console.error("Error updating grade:",i),alert("Failed to update grade. Please try again.")}finally{R(!1)}};if(z)return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:$.title}),e.jsx(_,{maxWidth:"xl",children:e.jsx("div",{children:"Loading grade management..."})})]});const X=J(),Z=K(),ee=Y();return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:$.title}),e.jsxs(_,{maxWidth:"xl",children:[e.jsx(de,{heading:"Grade Management",links:[{name:"Dashboard",href:w.dashboard.root},{name:"Instructor",href:w.dashboard.instructor.courses},{name:"Grade Management"}],sx:{mb:{xs:3,md:5}}}),T.length===0?e.jsxs(h,{sx:{p:4,textAlign:"center"},children:[e.jsx(r,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"You are not assigned to teach any courses yet."}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Contact an administrator to assign you to courses."})]}):x.length===0?e.jsxs(h,{sx:{p:4,textAlign:"center"},children:[e.jsx(r,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No students are enrolled in your courses yet."}),e.jsx(r,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Students will appear here once they enroll in your courses."})]}):e.jsxs(u,{container:!0,spacing:3,children:[e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(h,{sx:{p:3,textAlign:"center"},children:[e.jsx(r,{variant:"h4",color:"primary",gutterBottom:!0,children:X}),e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Average Grade"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Across all students"})]})}),e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(h,{sx:{p:3,textAlign:"center"},children:[e.jsx(r,{variant:"h4",color:"success.main",gutterBottom:!0,children:x.length}),e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Total Students"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Enrolled in courses"})]})}),e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(h,{sx:{p:3,textAlign:"center"},children:[e.jsx(r,{variant:"h4",color:"info.main",gutterBottom:!0,children:Z.length}),e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Graded Students"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"With final grades"})]})}),e.jsx(u,{item:!0,xs:12,md:3,children:e.jsxs(h,{sx:{p:3,textAlign:"center"},children:[e.jsx(r,{variant:"h4",color:"warning.main",gutterBottom:!0,children:ee.length}),e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Pending Grades"}),e.jsx(r,{variant:"body2",color:"text.secondary",children:"Need grading"})]})}),e.jsx(u,{item:!0,xs:12,children:e.jsxs(h,{sx:{p:3},children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Student Grades"}),e.jsx(he,{component:ne,variant:"outlined",children:e.jsxs(ue,{children:[e.jsx(xe,{children:e.jsxs(M,{children:[e.jsx(o,{children:"Student"}),e.jsx(o,{children:"Course"}),e.jsx(o,{children:"Enrollment Status"}),e.jsx(o,{children:"Final Grade"}),e.jsx(o,{children:"Letter Grade"}),e.jsx(o,{children:"Enrollment Date"}),e.jsx(o,{children:"Course Duration"}),e.jsx(o,{children:"Actions"})]})}),e.jsx(ge,{children:x.map(t=>{const i=t.FINAL_GRADE,n=F(i),d=B(i);return e.jsxs(M,{children:[e.jsxs(o,{children:[e.jsxs(r,{variant:"subtitle2",children:[t.FIRSTNAME," ",t.LASTNAME]}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t.EMAIL})]}),e.jsxs(o,{children:[e.jsx(r,{variant:"subtitle2",children:t.courseTitle}),e.jsx(r,{variant:"body2",color:"text.secondary",children:t.courseLocation})]}),e.jsx(o,{children:e.jsx(N,{label:t.STATUS,color:H(t.STATUS),size:"small"})}),e.jsx(o,{children:i?e.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:1},children:[e.jsxs(r,{variant:"body2",children:[i,"%"]}),e.jsx(ae,{variant:"determinate",value:i,color:n,sx:{width:60,height:6,borderRadius:3}})]}):e.jsx(r,{variant:"body2",color:"text.secondary",children:"Pending"})}),e.jsx(o,{children:i?e.jsx(N,{label:d,color:n,size:"small"}):e.jsx(r,{variant:"body2",color:"text.secondary",children:"N/A"})}),e.jsx(o,{children:m(t.ENROLL_DATE)}),e.jsxs(o,{children:[m(t.courseStartDate)," - ",m(t.courseEndDate)]}),e.jsx(o,{children:e.jsx(oe,{title:"Edit Grade",children:e.jsx(ie,{size:"small",onClick:()=>q(t),color:"primary",children:e.jsx(le,{icon:"eva:edit-fill"})})})})]},`${t.UID}-${t.courseId}`)})})]})})]})}),e.jsx(u,{item:!0,xs:12,children:e.jsx(r,{variant:"h6",gutterBottom:!0,children:"Grade Distribution by Course"})}),T.map(t=>{const i=x.filter(s=>s.courseId===t.COURSEID),n=i.filter(s=>s.FINAL_GRADE!=null&&!isNaN(s.FINAL_GRADE)),d=n.length>0?(n.reduce((s,g)=>s+parseFloat(g.FINAL_GRADE),0)/n.length).toFixed(2):0;return e.jsx(u,{item:!0,xs:12,md:6,lg:4,children:e.jsx(h,{sx:{p:3,height:"100%"},children:e.jsxs(W,{spacing:2,children:[e.jsxs(j,{children:[e.jsx(r,{variant:"h6",gutterBottom:!0,children:t.TITLE}),e.jsx(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:t.LOCATION})]}),e.jsxs(j,{children:[e.jsxs(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Total Students:"})," ",i.length]}),e.jsxs(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Graded Students:"})," ",n.length]}),e.jsxs(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Average Grade:"})," ",d,"%"]}),e.jsxs(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Duration:"})," ",m(t.STARTDATE)," - ",m(t.ENDDATE)]})]}),n.length>0&&e.jsxs(j,{children:[e.jsx(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Grade Distribution"}),e.jsx(W,{spacing:1,children:n.map(s=>e.jsxs(j,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs(r,{variant:"body2",children:[s.FIRSTNAME," ",s.LASTNAME]}),e.jsx(N,{label:`${s.FINAL_GRADE}% (${B(s.FINAL_GRADE)})`,color:F(s.FINAL_GRADE),size:"small"})]},s.UID))})]})]})})},t.COURSEID)})]}),e.jsxs(ce,{open:V,onClose:I,maxWidth:"sm",fullWidth:!0,children:[e.jsxs(je,{children:["Update Grade for ",l==null?void 0:l.FIRSTNAME," ",l==null?void 0:l.LASTNAME]}),e.jsx(me,{children:e.jsxs(j,{sx:{pt:2},children:[e.jsxs(r,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:["Course: ",l==null?void 0:l.courseTitle]}),e.jsx(pe,{fullWidth:!0,label:"Final Grade (%)",type:"number",value:A,onChange:t=>D(t.target.value),inputProps:{min:0,max:100,step:.1},sx:{mt:2}})]})}),e.jsxs(Ae,{children:[e.jsx(O,{onClick:I,disabled:y,children:"Cancel"}),e.jsx(O,{onClick:Q,variant:"contained",disabled:y||!A,children:y?"Updating...":"Update Grade"})]})]})]})]})}export{Se as default};
