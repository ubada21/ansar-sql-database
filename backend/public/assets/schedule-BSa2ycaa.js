import{z as J,E as Q,r as f,G as E,O as R,j as e,e as V,w as $,p as N,k as h,T as s,B as l,ab as X}from"./index-SPR10c_z.js";import{C as Z}from"./custom-breadcrumbs-DKozQT1O.js";import{G as c}from"./Grid-B4VvxZ4z.js";import{S as W}from"./Stack-CJz44gKr.js";const k={title:`My Schedule | Student Dashboard - ${V.appName}`};function se(){const z=J(),{authenticated:j,user:a}=Q(),[x,F]=f.useState([]),[b,L]=f.useState({}),[Y,T]=f.useState(!0),D=f.useCallback(async()=>{if(a!=null&&a.UID)try{T(!0);const r=(await E.get(R.courses.list)).data.courses||[],o=[];for(const d of r)try{const g=((await E.get(R.courses.students(d.COURSEID))).data.students||[]).find(S=>S.UID===a.UID);g&&o.push({...d,enrollment:g})}catch(i){console.error(`Error fetching enrollment for course ${d.COURSEID}:`,i)}F(o);const n={};for(const d of o)try{const i=await E.get(R.courses.schedule(d.COURSEID));n[d.COURSEID]=i.data.schedule||[]}catch(i){console.error(`Error fetching schedule for course ${d.COURSEID}:`,i),n[d.COURSEID]=[]}L(n)}catch(t){console.error("Error fetching enrolled courses:",t)}finally{T(!1)}},[a==null?void 0:a.UID]);if(f.useEffect(()=>{j&&(a!=null&&a.UID)&&D()},[j,a==null?void 0:a.UID,D]),!j)return z.push("/login"),null;const p=t=>{const r=new Date,o=new Date(t.STARTDATE),n=new Date(t.ENDDATE);return o>r?{label:"Upcoming",color:"info"}:o<=r&&n>=r?{label:"Ongoing",color:"success"}:{label:"Completed",color:"default"}},w=t=>new Date(t).toLocaleDateString(),m=t=>{if(!t)return"TBD";const r=new Date(`2000-01-01T${t}`),o=r.getHours(),n=r.getMinutes(),d=o>=12?"PM":"AM",i=o%12||12,u=n.toString().padStart(2,"0");return`${i}:${u} ${d}`},y=t=>{const[r,o]=t.split(":").map(Number);return r*60+o},I=t=>({Monday:"Mon",Tuesday:"Tue",Wednesday:"Wed",Thursday:"Thu",Friday:"Fri",Saturday:"Sat",Sunday:"Sun"})[t]||t,_=()=>{const t=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"],r=["08:00","09:00","10:00","11:00","12:00","13:00","14:00","15:00","16:00","17:00","18:00","19:00","20:00","21:00"],o=[];return x.forEach(n=>{(b[n.COURSEID]||[]).forEach(i=>{const u=i.WEEKDAY,g=i.START_TIME,S=i.END_TIME;if(t.includes(u)){const B=y(g),O=y(S),U=t.indexOf(u),H=r.findIndex(C=>y(C)>=B),M=r.findIndex(C=>y(C)>=O),K=U+2,P=H+2,q=M>-1?M+2:r.length+2;o.push({course:n,scheduleItem:i,startTime:g,endTime:S,day:u,dayIndex:U,gridColumn:K,gridRowStart:P,gridRowEnd:q,startMinutes:B,endMinutes:O})}})}),{weekdays:t,timeSlots:r,courseBlocks:o}},{weekdays:v,timeSlots:A,courseBlocks:G}=_();return Y?e.jsxs(e.Fragment,{children:[e.jsx("title",{children:k.title}),e.jsx($,{maxWidth:"xl",children:e.jsx("div",{children:"Loading your schedule..."})})]}):e.jsxs(e.Fragment,{children:[e.jsx("title",{children:k.title}),e.jsxs($,{maxWidth:"xl",children:[e.jsx(Z,{heading:"My Schedule",links:[{name:"Dashboard",href:N.dashboard.root},{name:"Student",href:N.dashboard.student.courses},{name:"My Schedule"}],sx:{mb:{xs:3,md:5}}}),x.length===0?e.jsxs(h,{sx:{p:4,textAlign:"center"},children:[e.jsx(s,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"You are not enrolled in any courses yet."}),e.jsx(s,{variant:"body2",color:"text.secondary",sx:{mb:3},children:"Contact an administrator to enroll you in courses."})]}):e.jsxs(c,{container:!0,spacing:3,children:[e.jsx(c,{item:!0,xs:12,md:4,children:e.jsxs(h,{sx:{p:3,textAlign:"center",border:"1px solid #e0e0e0",borderRadius:2,boxShadow:"0 4px 12px rgba(0,0,0,0.1)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 24px rgba(0,0,0,0.15)",transform:"translateY(-4px)",borderColor:"info.main"}},children:[e.jsx(s,{variant:"h4",color:"info.main",gutterBottom:!0,children:x.filter(t=>p(t).label==="Upcoming").length}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Upcoming Courses"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Starting soon"})]})}),e.jsx(c,{item:!0,xs:12,md:4,children:e.jsxs(h,{sx:{p:3,textAlign:"center",border:"1px solid #e0e0e0",borderRadius:2,boxShadow:"0 4px 12px rgba(0,0,0,0.1)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 24px rgba(0,0,0,0.15)",transform:"translateY(-4px)",borderColor:"success.main"}},children:[e.jsx(s,{variant:"h4",color:"success.main",gutterBottom:!0,children:x.filter(t=>p(t).label==="Ongoing").length}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Ongoing Courses"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Currently enrolled"})]})}),e.jsx(c,{item:!0,xs:12,md:4,children:e.jsxs(h,{sx:{p:3,textAlign:"center",border:"1px solid #e0e0e0",borderRadius:2,boxShadow:"0 4px 12px rgba(0,0,0,0.1)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 24px rgba(0,0,0,0.15)",transform:"translateY(-4px)",borderColor:"primary.main"}},children:[e.jsx(s,{variant:"h4",color:"primary",gutterBottom:!0,children:x.filter(t=>p(t).label==="Completed").length}),e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Completed Courses"}),e.jsx(s,{variant:"body2",color:"text.secondary",children:"Finished courses"})]})}),e.jsx(c,{item:!0,xs:12,children:e.jsxs(h,{sx:{p:3},children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:"Weekly Schedule"}),e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"80px repeat(7, 1fr)",gridTemplateRows:"auto repeat(14, 60px)",gap:0,mt:2,border:"1px solid #e0e0e0",borderRadius:1,overflow:"hidden",position:"relative"},children:[e.jsx(l,{sx:{gridColumn:"1",gridRow:"1",backgroundColor:"#f5f5f5",borderRight:"1px solid #e0e0e0",borderBottom:"1px solid #e0e0e0",p:1,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"0.875rem"},children:"Time"}),v.map((t,r)=>e.jsx(l,{sx:{gridColumn:`${r+2}`,gridRow:"1",backgroundColor:"#f5f5f5",borderBottom:"1px solid #e0e0e0",borderRight:"1px solid #e0e0e0",p:1,textAlign:"center",fontWeight:"bold",fontSize:"0.875rem"},children:I(t)},t)),A.map((t,r)=>e.jsx(l,{sx:{gridColumn:"1",gridRow:`${r+2}`,backgroundColor:"#f9f9f9",borderRight:"1px solid #e0e0e0",borderBottom:"1px solid #e0e0e0",p:1,display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"0.75rem"},children:m(t)},t)),A.map((t,r)=>v.map((o,n)=>e.jsx(l,{sx:{gridColumn:`${n+2}`,gridRow:`${r+2}`,borderRight:"1px solid #e0e0e0",borderBottom:"1px solid #e0e0e0",backgroundColor:r%2===0?"#ffffff":"#fafafa"}},`${o}-${t}`))),G.map((t,r)=>{const o=p(t.course);return e.jsxs(l,{sx:{gridColumn:t.gridColumn,gridRow:`${t.gridRowStart} / ${t.gridRowEnd}`,backgroundColor:o.color==="success"?"success.light":o.color==="info"?"info.light":"grey.100",border:`2px solid ${o.color==="success"?"success.main":o.color==="info"?"info.main":"grey.300"}`,borderRadius:1,p:1,m:.5,fontSize:"0.7rem",lineHeight:1.1,display:"flex",flexDirection:"column",justifyContent:"center",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",cursor:"pointer",transition:"all 0.2s ease",zIndex:1,"&:hover":{boxShadow:"0 4px 8px rgba(0,0,0,0.2)",transform:"translateY(-1px)",zIndex:2}},children:[e.jsx(s,{variant:"caption",sx:{fontWeight:"bold",display:"block",textAlign:"center",fontSize:"0.65rem",mb:.5},children:t.course.TITLE}),e.jsxs(s,{variant:"caption",sx:{display:"block",textAlign:"center",fontSize:"0.6rem",opacity:.8,mb:.5},children:[m(t.startTime)," - ",m(t.endTime)]}),e.jsx(s,{variant:"caption",sx:{display:"block",textAlign:"center",fontSize:"0.6rem",opacity:.7},children:t.course.LOCATION})]},`${t.course.COURSEID}-${r}`)})]})]})}),e.jsx(c,{container:!0,spacing:3,sx:{mt:2},children:x.map(t=>{const r=p(t);return e.jsx(c,{item:!0,xs:12,md:6,lg:4,children:e.jsx(h,{sx:{p:3,height:"100%",border:"1px solid #e0e0e0",borderRadius:2,boxShadow:"0 4px 12px rgba(0,0,0,0.1)",transition:"all 0.3s ease","&:hover":{boxShadow:"0 8px 24px rgba(0,0,0,0.15)",transform:"translateY(-4px)",borderColor:"primary.main"}},children:e.jsxs(W,{spacing:2,children:[e.jsxs(l,{children:[e.jsx(s,{variant:"h6",gutterBottom:!0,children:t.TITLE}),e.jsx(W,{direction:"row",spacing:1,flexWrap:"wrap",useFlexGap:!0,children:e.jsx(X,{label:r.label,color:r.color,size:"small"})})]}),e.jsxs(l,{children:[e.jsxs(s,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Location:"})," ",t.LOCATION]}),e.jsxs(s,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"Start Date:"})," ",w(t.STARTDATE)]}),e.jsxs(s,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:[e.jsx("strong",{children:"End Date:"})," ",w(t.ENDDATE)]}),e.jsx(s,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:e.jsx("strong",{children:"Schedule:"})}),b[t.COURSEID]&&b[t.COURSEID].length>0?b[t.COURSEID].map((o,n)=>e.jsxs(s,{variant:"body2",color:"text.secondary",sx:{pl:2},children:[I(o.WEEKDAY),": ",m(o.START_TIME)," - ",m(o.END_TIME)]},n)):e.jsx(s,{variant:"body2",color:"text.secondary",sx:{pl:2},children:"No schedule set"}),t.INSTRUCTOR_NAMES&&e.jsxs(s,{variant:"body2",color:"text.secondary",children:[e.jsx("strong",{children:"Instructor:"})," ",t.INSTRUCTOR_NAMES]})]})]})})},t.COURSEID)})})]})]})]})}export{se as default};
