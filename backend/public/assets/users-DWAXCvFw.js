import{j as e,V as re,A as ne,B as g,W as m,X as H,d as R,Y as q,K as B,k as oe,b as ie,R as z,Z as A,_ as K,Q as P,I as v,$ as X,a0 as Z,r as u,O as ce,a1 as de,E as U,v as N,p as F,w as ue,U as he,x as xe,a2 as me,e as pe}from"./index-C4gKnlNZ.js";import{t as E,D as je,a as ge,b as fe,F as be,c as M,C as O,d as $}from"./filters-result-DsCe74ZT.js";import{u as Ce,a as ve,o as we,F as ye,b,s as C,c as Se,I as Te,S as ke,T as De}from"./form-provider-C5uGq2GD.js";import{T as Ee,a as k,C as Y,b as J,u as Re,g as Ie,r as Ue,c as Fe,d as Ae,e as Pe,f as Le,h as Ne,i as Me,j as Oe,k as $e}from"./table-pagination-custom-CEIcVhuD.js";import{a as Be,C as ze}from"./custom-breadcrumbs-BhuFLxww.js";import{S as _e}from"./Stack-BBoccUvf.js";import"./Grid-DrwRTrSg.js";import"./isMuiElement-B6AljemQ.js";const Ge=we({name:C().min(1,{message:"Name is required!"}),email:C().min(1,{message:"Email is required!"}).email({message:"Email must be a valid email address!"}),phoneNumber:C().optional(),country:C().optional(),state:C().optional(),city:C().optional(),address:C().optional(),zipCode:C().optional(),company:C().optional(),role:C().optional(),status:C().optional()});function Qe({currentUser:s,open:n,onClose:o}){const c={name:"",email:"",phoneNumber:"",address:"",country:"",state:"",city:"",zipCode:"",status:"",company:"",role:""},r=Ce({mode:"all",resolver:ve(Ge),defaultValues:c,values:s}),{reset:i,handleSubmit:d,formState:{isSubmitting:p}}=r,a=d(async t=>{const h=new Promise(j=>setTimeout(j,1e3));try{i(),o(),E.promise(h,{loading:"Loading...",success:"Update success!",error:"Update error!"}),await h,console.info("DATA",t)}catch(j){console.error(j)}});return e.jsx(re,{fullWidth:!0,maxWidth:!1,open:n,onClose:o,slotProps:{backdrop:{invisible:!0}},PaperProps:{sx:{maxWidth:720}},children:e.jsxs(ye,{methods:r,onSubmit:a,children:[e.jsx(je,{children:"Quick Update"}),e.jsxs(ge,{dividers:!0,sx:{pt:3},children:[e.jsx(ne,{severity:"info",sx:{mb:3},children:"Update the information below and we will update you when changes are made."}),e.jsxs(g,{rowGap:3,columnGap:2,display:"grid",gridTemplateColumns:{xs:"repeat(1, 1fr)",sm:"repeat(2, 1fr)"},children:[e.jsx(b.Text,{name:"name",label:"Full Name"}),e.jsx(b.Text,{name:"email",label:"Email Address"}),e.jsx(b.Text,{name:"phoneNumber",label:"Phone Number"}),e.jsx(b.Text,{name:"address",label:"Address"}),e.jsx(b.Text,{name:"country",label:"Country"}),e.jsx(b.Text,{name:"state",label:"State/Region"}),e.jsx(b.Text,{name:"city",label:"City"}),e.jsx(b.Text,{name:"zipCode",label:"Zip/Code"}),e.jsx(b.Text,{name:"company",label:"Company"}),e.jsxs(b.Select,{name:"role",label:"Role",children:[e.jsx(m,{value:"leader",children:" Leader "}),e.jsx(m,{value:"hr",children:" HR "}),e.jsx(m,{value:"ui designer",children:" UI Designer "}),e.jsx(m,{value:"ux designer",children:" UX Designer "}),e.jsx(m,{value:"ui/ux designer",children:" UI/UX Designer "}),e.jsx(m,{value:"project manager",children:" Project Manager "}),e.jsx(m,{value:"backend developer",children:" Backend Developer "}),e.jsx(m,{value:"full stack designer",children:" Full Stack Designer "}),e.jsx(m,{value:"front end developer",children:" Front End Developer "}),e.jsx(m,{value:"full stack developer",children:" Full Stack Developer "})]}),e.jsx(b.Select,{name:"status",label:"Status",children:H.map(t=>e.jsx(m,{value:t.value,children:t.label},t.value))})]})]}),e.jsxs(fe,{children:[e.jsx(R,{variant:"outlined",color:"inherit",onClick:o,children:"Cancel"}),e.jsx(R,{type:"submit",variant:"contained",disabled:p,children:"Update"})]})]})})}function Ve({row:s,userRoles:n,selected:o,editHref:c,onSelectRow:r,onDeleteRow:i}){const d=q(),p=B(),a=B(),t=()=>e.jsx(Qe,{currentUser:s,open:a.value,onClose:a.onFalse}),h=()=>e.jsx(X,{open:d.open,anchorEl:d.anchorEl,onClose:d.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(Z,{children:[e.jsx("li",{children:e.jsxs(m,{component:z,href:c,onClick:()=>d.onClose(),children:[e.jsx(v,{icon:"solar:pen-bold"}),"Edit"]})}),e.jsxs(m,{onClick:()=>{p.onTrue(),d.onClose()},sx:{color:"error.main"},children:[e.jsx(v,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})}),j=()=>e.jsx(J,{open:p.value,onClose:p.onFalse,title:"Delete",content:"Are you sure want to delete?",action:e.jsx(R,{variant:"contained",color:"error",onClick:i,children:"Delete"})});return e.jsxs(e.Fragment,{children:[e.jsxs(Ee,{hover:!0,selected:o,"aria-checked":o,tabIndex:-1,children:[e.jsx(k,{padding:"checkbox",children:e.jsx(Y,{checked:o,onClick:r,slotProps:{input:{id:`${s.UID}-checkbox`,"aria-label":`${s.UID} checkbox`}}})}),e.jsx(k,{children:e.jsxs(g,{sx:{gap:2,display:"flex",alignItems:"center"},children:[e.jsx(oe,{alt:`${s.FIRSTNAME} ${s.LASTNAME}`}),e.jsxs(_e,{sx:{typography:"body2",flex:"1 1 auto",alignItems:"flex-start"},children:[e.jsxs(ie,{component:z,href:c,color:"inherit",sx:{cursor:"pointer"},children:[s.FIRSTNAME," ",s.LASTNAME]}),e.jsxs(g,{component:"span",sx:{color:"text.disabled"},children:["ID: ",s.UID]})]})]})}),e.jsx(k,{sx:{whiteSpace:"nowrap"},children:s.EMAIL}),e.jsx(k,{sx:{whiteSpace:"nowrap"},children:s.PHONENUMBER||"N/A"}),e.jsx(k,{sx:{whiteSpace:"nowrap"},children:n.length>0?e.jsx(g,{sx:{display:"flex",flexDirection:"column",gap:.5},children:n.map(w=>e.jsx(A,{variant:"soft",color:w.ROLENAME==="admin"?"primary":"default",sx:{fontSize:"0.75rem"},children:w.ROLENAME},w.ROLEID))}):e.jsx(A,{variant:"soft",color:"default",sx:{fontSize:"0.75rem"},children:"No roles"})}),e.jsx(k,{children:e.jsx(A,{variant:"soft",color:"success",children:"Active"})}),e.jsx(k,{children:e.jsxs(g,{sx:{display:"flex",alignItems:"center"},children:[e.jsx(K,{title:"Quick edit",placement:"top",arrow:!0,children:e.jsx(P,{color:a.value?"inherit":"default",onClick:a.onTrue,children:e.jsx(v,{icon:"solar:pen-bold"})})}),e.jsx(P,{color:d.open?"inherit":"default",onClick:d.onOpen,children:e.jsx(v,{icon:"eva:more-vertical-fill"})})]})})]}),t(),h(),j()]})}function We({filters:s,options:n,onResetPage:o}){const c=q(),{state:r,setState:i}=s,d=u.useCallback(t=>{o(),i({name:t.target.value})},[o,i]),p=u.useCallback(t=>{const h=typeof t.target.value=="string"?t.target.value.split(","):t.target.value;o(),i({role:h})},[o,i]),a=()=>e.jsx(X,{open:c.open,anchorEl:c.anchorEl,onClose:c.onClose,slotProps:{arrow:{placement:"right-top"}},children:e.jsxs(Z,{children:[e.jsxs(m,{onClick:()=>c.onClose(),children:[e.jsx(v,{icon:"solar:printer-minimalistic-bold"}),"Print"]}),e.jsxs(m,{onClick:()=>c.onClose(),children:[e.jsx(v,{icon:"solar:import-bold"}),"Import"]}),e.jsxs(m,{onClick:()=>c.onClose(),children:[e.jsx(v,{icon:"solar:export-bold"}),"Export"]})]})});return e.jsxs(e.Fragment,{children:[e.jsxs(g,{sx:{p:2.5,gap:2,display:"flex",pr:{xs:2.5,md:1},flexDirection:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"}},children:[e.jsxs(Se,{sx:{flexShrink:0,width:{xs:1,md:200}},children:[e.jsx(Te,{htmlFor:"filter-role-select",children:"Role"}),e.jsx(ke,{multiple:!0,label:"Role",value:r.role,onChange:p,renderValue:t=>t.map(h=>h).join(", "),inputProps:{id:"filter-role-select"},MenuProps:{PaperProps:{sx:{maxHeight:240}}},children:n.roles.map(t=>e.jsxs(m,{value:t,children:[e.jsx(Y,{disableRipple:!0,size:"small",checked:r.role.includes(t),slotProps:{input:{id:`${t}-checkbox`}}}),t]},t))})]}),e.jsxs(g,{sx:{gap:2,width:1,flexGrow:1,display:"flex",alignItems:"center"},children:[e.jsx(De,{fullWidth:!0,value:r.name,onChange:d,placeholder:"Search...",slotProps:{input:{startAdornment:e.jsx(ce,{position:"start",children:e.jsx(v,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}}),e.jsx(P,{onClick:c.onOpen,children:e.jsx(v,{icon:"eva:more-vertical-fill"})})]})]}),a()]})}function He({filters:s,onResetPage:n,totalResults:o,sx:c}){const{state:r,setState:i,resetState:d}=s,p=u.useCallback(()=>{n(),i({name:""})},[n,i]),a=u.useCallback(()=>{n(),i({status:"all"})},[n,i]),t=u.useCallback(j=>{const w=r.role.filter(y=>y!==j);n(),i({role:w})},[n,i,r.role]),h=u.useCallback(()=>{n(),d()},[n,d]);return e.jsxs(be,{totalResults:o,onReset:h,sx:c,children:[e.jsx(M,{label:"Status:",isShow:r.status!=="all",children:e.jsx(O,{...$,label:r.status,onDelete:a,sx:{textTransform:"capitalize"}})}),e.jsx(M,{label:"Role:",isShow:!!r.role.length,children:r.role.map(j=>u.createElement(O,{...$,key:j,label:j,onDelete:()=>t(j)}))}),e.jsx(M,{label:"Keyword:",isShow:!!r.name,children:e.jsx(O,{...$,label:r.name,onDelete:p})})]})}const qe=[{value:"all",label:"All"},...H],Ke=[{id:"name",label:"Name"},{id:"email",label:"Email",width:220},{id:"phoneNumber",label:"Phone number",width:180},{id:"roles",label:"Roles",width:200},{id:"status",label:"Status",width:100},{id:"",width:88}];function Xe(){const s=Re(),n=B(),[o,c]=u.useState([]),[r,i]=u.useState({}),[d,p]=u.useState(!0),[a,t]=u.useState(""),[h,j]=u.useState([]),w=de({name:"",role:[],status:"all"}),{state:y,setState:_}=w,G=u.useCallback(async()=>{try{p(!0);const l=await fetch(U.API_URL+"/users",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"}),x=await l.json();if(l.ok){const D=x.users||[];c(D);const S={};for(const T of D)try{const I=await fetch(U.API_URL+`/users/${T.UID}/roles`,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(I.ok){const ae=await I.json();S[T.UID]=ae.roles||[]}else S[T.UID]=[]}catch(I){console.error(`Error fetching roles for user ${T.UID}:`,I),S[T.UID]=[]}i(S)}else t(x.message||"Failed to fetch users")}catch(l){console.error("Error fetching users:",l),t("Failed to fetch users")}finally{p(!1)}},[]),Q=u.useCallback(async()=>{try{const l=await fetch(U.API_URL+"/roles",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(l.ok){const x=await l.json();j(x.roles||[])}}catch(l){console.error("Error fetching roles:",l)}},[]);u.useEffect(()=>{G(),Q()},[G,Q]);const f=Ze({inputData:o,comparator:Ie(s.order,s.orderBy),filters:y,userRoles:r}),V=Ue(f,s.page,s.rowsPerPage),W=!!y.name||y.role.length>0||y.status!=="all",ee=!f.length&&W||!f.length,L=u.useCallback(async l=>{try{const x=await fetch(U.API_URL+`/users/${l}`,{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"});if(x.ok){const D=o.filter(T=>T.UID!==l);c(D);const S={...r};delete S[l],i(S),E.success("Delete success!"),s.onUpdatePageDeleteRow(V.length)}else{const D=await x.json();E.error(D.message||"Failed to delete user")}}catch(x){console.error("Error deleting user:",x),E.error("Failed to delete user")}},[V.length,s,o,r]),se=u.useCallback(async()=>{try{for(const l of s.selected)await L(l);E.success(`${s.selected.length} users deleted successfully!`)}catch(l){console.error("Error deleting selected users:",l),E.error("Failed to delete some users")}},[s.selected,L]),le=u.useCallback((l,x)=>{s.onResetPage(),_({status:x})},[_,s]),te=()=>e.jsx(J,{open:n.value,onClose:n.onFalse,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsxs("strong",{children:[" ",s.selected.length," "]})," items?"]}),action:e.jsx(R,{variant:"contained",color:"error",onClick:()=>{se(),n.onFalse()},children:"Delete"})});return d?e.jsx(N,{children:e.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:400},children:e.jsx(g,{children:"Loading users..."})})}):a?e.jsx(N,{children:e.jsx(g,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:400},children:e.jsx(g,{sx:{color:"error.main"},children:a})})}):e.jsxs(e.Fragment,{children:[e.jsxs(N,{children:[e.jsx(Be,{heading:"Users List",links:[{name:"Dashboard",href:F.dashboard.root},{name:"Users",href:F.dashboard.users},{name:"List"}],action:e.jsx(R,{component:z,href:F.dashboard.user.new,variant:"contained",startIcon:e.jsx(v,{icon:"mingcute:add-line"}),children:"Add user"}),sx:{mb:{xs:3,md:5}}}),e.jsxs(ze,{children:[e.jsx(ue,{value:y.status,onChange:le,sx:[l=>({px:{md:2.5},boxShadow:`inset 0 -2px 0 0 ${he(l.vars.palette.grey["500Channel"],.08)}`})],children:qe.map(l=>e.jsx(xe,{iconPosition:"end",value:l.value,label:l.label,icon:e.jsx(A,{variant:(l.value==="all"||l.value===y.status)&&"filled"||"soft",color:l.value==="active"&&"success"||l.value==="pending"&&"warning"||l.value==="banned"&&"error"||"default",children:l.value==="all"?o.length:o.filter(x=>x.status===l.value).length})},l.value))}),e.jsx(We,{filters:w,onResetPage:s.onResetPage,options:{roles:h.map(l=>l.ROLENAME)}}),W&&e.jsx(He,{filters:w,totalResults:f.length,onResetPage:s.onResetPage,sx:{p:2.5,pt:0}}),e.jsxs(g,{sx:{position:"relative"},children:[e.jsx(Fe,{dense:s.dense,numSelected:s.selected.length,rowCount:f.length,onSelectAllRows:l=>s.onSelectAllRows(l,f.map(x=>x.UID)),action:e.jsx(K,{title:"Delete",children:e.jsx(P,{color:"primary",onClick:n.onTrue,children:e.jsx(v,{icon:"solar:trash-bin-trash-bold"})})})}),e.jsx(me,{children:e.jsxs(Ae,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(Pe,{order:s.order,orderBy:s.orderBy,headCells:Ke,rowCount:f.length,numSelected:s.selected.length,onSort:s.onSort,onSelectAllRows:l=>s.onSelectAllRows(l,f.map(x=>x.UID))}),e.jsxs(Le,{children:[f.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(l=>e.jsx(Ve,{row:l,userRoles:r[l.UID]||[],selected:s.selected.includes(l.UID),onSelectRow:()=>s.onSelectRow(l.UID),onDeleteRow:()=>L(l.UID),editHref:F.dashboard.users},l.UID)),e.jsx(Ne,{height:s.dense?56:76,emptyRows:Me(s.page,s.rowsPerPage,f.length)}),e.jsx(Oe,{notFound:ee})]})]})})]}),e.jsx($e,{page:s.page,dense:s.dense,count:f.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})]}),te()]})}function Ze({inputData:s,comparator:n,filters:o,userRoles:c}){const{name:r,status:i,role:d}=o,p=s.map((a,t)=>[a,t]);return p.sort((a,t)=>{const h=n(a[0],t[0]);return h!==0?h:a[1]-t[1]}),s=p.map(a=>a[0]),r&&(s=s.filter(a=>`${a.FIRSTNAME} ${a.LASTNAME}`.toLowerCase().includes(r.toLowerCase())||a.EMAIL.toLowerCase().includes(r.toLowerCase()))),i!=="all"&&(s=s.filter(a=>a.status===i)),d.length&&(s=s.filter(a=>{const t=c[a.UID]||[];return d.some(h=>t.some(j=>j.ROLENAME===h))})),s}const Ye={title:`Users | Dashboard - ${pe.appName}`};function os(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:Ye.title}),e.jsx(Xe,{})]})}export{os as default};
