import{r as o,h as A,i as k,j as e,o as te,B as z,T as r,k as N,n as E,Q as ne,V as oe,d as F,b as re,w as ae,x as _,I as le,q as O,u as ie,f as ce,p as P,e as K,D as $,R as de,O as he}from"./index-BbQvotS-.js";import{D as xe,a as ue,f as I,b as je,F as me,c as B,C as M,d as V,t as U,e as be}from"./filters-result-DkRmtI61.js";import{C as ge}from"./course-quick-edit-form-C8TTaT98.js";import{T as pe,a as v,u as Ce,c as fe,d as De,e as ye,f as Se,h as Ee,i as Te,j as we,k as Re,b as ve,g as Ie}from"./table-pagination-custom-BGbLI6ve.js";import{S as q}from"./Stack-zS2s7YZH.js";import{G as C}from"./Grid-Dk2x3y-O.js";import{T as Q}from"./form-provider-PToGIMDl.js";import"./isMuiElement-CCJ6kdzU.js";function Ae({open:t,onClose:c,courseId:s}){const[a,m]=o.useState(null),[j,d]=o.useState([]),[l,u]=o.useState([]),[b,f]=o.useState([]),[T,w]=o.useState(!1),L=o.useCallback(async()=>{w(!0);try{const i=await A.get(k.courses.details(s));m(i.data.course);try{const x=await A.get(k.courses.instructors(s));d(x.data.instructors||[])}catch(x){console.error("Error fetching instructors:",x),d([])}try{const x=await A.get(k.courses.students(s));u(x.data.students||[])}catch(x){console.error("Error fetching students:",x),u([])}try{const x=await A.get(k.courses.schedule(s));f(x.data.schedule||[])}catch(x){console.error("Error fetching schedule:",x),f([])}}catch(i){console.error("Error fetching course details:",i)}finally{w(!1)}},[s]);o.useEffect(()=>{t&&s&&L()},[t,s,L]);const y=()=>{m(null),d([]),u([]),f([]),c()},g=a?((i,x)=>{const D=new Date,S=new Date(i),R=new Date(x);return S>D?{label:"Upcoming",color:"info"}:S<=D&&R>=D?{label:"Ongoing",color:"success"}:{label:"Completed",color:"default"}})(a.STARTDATE,a.ENDDATE):null;return e.jsxs(te,{fullWidth:!0,maxWidth:"md",open:t,onClose:y,PaperProps:{sx:{borderRadius:2}},children:[e.jsx(xe,{sx:{pb:2},children:e.jsxs(z,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx(r,{variant:"h6",children:"Course Details"}),e.jsx(N,{onClick:y,children:e.jsx(E,{icon:"eva:close-fill"})})]})}),e.jsx(ue,{sx:{pb:2},children:T?e.jsx(z,{sx:{display:"flex",justifyContent:"center",py:4},children:e.jsx(ne,{})}):a?e.jsxs(q,{spacing:3,children:[e.jsxs(I,{sx:{p:3},children:[e.jsx(r,{variant:"h5",sx:{mb:2,color:"primary.main"},children:a.TITLE}),e.jsxs(C,{container:!0,spacing:2,children:[e.jsxs(C,{size:{xs:12,sm:6},children:[e.jsx(r,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Course ID"}),e.jsx(r,{variant:"body1",sx:{mb:2},children:a.COURSEID})]}),e.jsxs(C,{size:{xs:12,sm:6},children:[e.jsx(r,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Status"}),e.jsx(r,{variant:"body1",sx:{mb:2,color:(g==null?void 0:g.color)==="success"?"success.main":(g==null?void 0:g.color)==="info"?"info.main":"text.secondary"},children:g==null?void 0:g.label})]}),e.jsxs(C,{size:{xs:12,sm:6},children:[e.jsx(r,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Location"}),e.jsx(r,{variant:"body1",sx:{mb:2},children:a.LOCATION})]}),e.jsxs(C,{size:{xs:12,sm:6},children:[e.jsx(r,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Capacity"}),e.jsx(r,{variant:"body1",sx:{mb:2},children:a.CAPACITY||"Not specified"})]}),e.jsxs(C,{size:{xs:12,sm:6},children:[e.jsx(r,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Start Date"}),e.jsx(r,{variant:"body1",sx:{mb:2},children:new Date(a.STARTDATE).toLocaleDateString()})]}),e.jsxs(C,{size:{xs:12,sm:6},children:[e.jsx(r,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"End Date"}),e.jsx(r,{variant:"body1",sx:{mb:2},children:new Date(a.ENDDATE).toLocaleDateString()})]}),a.DESCRIPTION&&e.jsxs(C,{size:{xs:12},children:[e.jsx(r,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Description"}),e.jsx(r,{variant:"body1",children:a.DESCRIPTION})]}),e.jsxs(C,{size:{xs:12},children:[e.jsx(r,{variant:"body2",sx:{color:"text.secondary",mb:.5},children:"Instructors"}),j.length>0?e.jsx(z,{sx:{display:"flex",flexWrap:"wrap",gap:1},children:j.map(i=>e.jsxs(r,{variant:"body1",sx:{color:"primary.main",fontWeight:500,"&:not(:last-child)":{"&::after":{content:'","',color:"text.secondary"}}},children:[i.FIRSTNAME," ",i.LASTNAME]},i.UID))}):e.jsx(r,{variant:"body1",sx:{color:"text.secondary",fontStyle:"italic"},children:"No instructors assigned"})]})]})]}),e.jsxs(I,{sx:{p:3},children:[e.jsxs(r,{variant:"h6",sx:{mb:2},children:["Schedule (",b.length," sessions)"]}),b.length>0?e.jsx(C,{container:!0,spacing:2,children:b.map(i=>e.jsx(C,{size:{xs:12,sm:6,md:4},children:e.jsxs(I,{sx:{p:2,bgcolor:"background.neutral"},children:[e.jsx(r,{variant:"subtitle2",sx:{color:"primary.main",mb:1},children:i.WEEKDAY}),e.jsxs(r,{variant:"body2",sx:{color:"text.secondary"},children:[i.START_TIME," - ",i.END_TIME]})]})},i.SCHEDULEID))}):e.jsx(r,{variant:"body2",sx:{color:"text.secondary",fontStyle:"italic"},children:"No schedule set for this course."})]}),e.jsx(oe,{}),e.jsxs(I,{sx:{p:3},children:[e.jsxs(r,{variant:"h6",sx:{mb:2},children:["Enrolled Students (",l.length,")"]}),l.length>0?e.jsx(C,{container:!0,spacing:2,children:l.map(i=>e.jsx(C,{size:{xs:12,sm:6,md:4},children:e.jsxs(I,{sx:{p:2,bgcolor:"background.neutral"},children:[e.jsxs(r,{variant:"subtitle2",children:[i.FIRSTNAME," ",i.LASTNAME]}),e.jsxs(r,{variant:"caption",sx:{color:"text.secondary"},children:["ID: ",i.UID]}),i.ENROLLMENT_DATE&&e.jsxs(r,{variant:"caption",sx:{color:"text.secondary",display:"block"},children:["Enrolled: ",new Date(i.ENROLLMENT_DATE).toLocaleDateString()]})]})},i.UID))}):e.jsx(r,{variant:"body2",sx:{color:"text.secondary",fontStyle:"italic"},children:"No students enrolled in this course."})]})]}):e.jsx(r,{variant:"body2",sx:{color:"text.secondary",textAlign:"center",py:4},children:"Course not found."})}),e.jsx(je,{sx:{px:3,pb:3},children:e.jsx(F,{variant:"outlined",color:"inherit",onClick:y,children:"Close"})})]})}function ke({row:t,selected:c,onSelectRow:s,onDeleteRow:a,onEditRow:m,onViewRow:j,onQuickEdit:d,editHref:l,onViewDetails:u}){const[b,f]=o.useState(!1),{COURSEID:T,TITLE:w,LOCATION:L,STARTDATE:y,ENDDATE:h}=t,g=o.useCallback(()=>{a()},[a]),x=(()=>{const D=new Date,S=new Date(y),R=new Date(h);return S>D?{label:"Upcoming",color:"info"}:S<=D&&R>=D?{label:"Ongoing",color:"success"}:{label:"Completed",color:"default"}})();return e.jsxs(e.Fragment,{children:[e.jsxs(pe,{hover:!0,selected:c,children:[e.jsx(v,{padding:"checkbox",children:e.jsx(N,{color:c?"primary":"default",onClick:()=>s(T),children:e.jsx(E,{icon:c?"eva:checkmark-circle-2-fill":"eva:radio-button-off-fill"})})}),e.jsx(v,{children:e.jsx("div",{style:{display:"flex",alignItems:"center"},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"14px"},children:e.jsx(re,{component:"button",variant:"body1",onClick:()=>u(T),sx:{color:"primary.main",textDecoration:"none","&:hover":{textDecoration:"underline"},cursor:"pointer",border:"none",background:"none",padding:0,font:"inherit"},children:w})}),e.jsxs("div",{style:{fontSize:"12px",color:"#666"},children:["ID: ",T]})]})})}),e.jsx(v,{children:e.jsx("div",{style:{fontSize:"14px"},children:L})}),e.jsx(v,{children:e.jsx("div",{style:{fontSize:"14px"},children:new Date(y).toLocaleDateString()})}),e.jsx(v,{children:e.jsx("div",{style:{fontSize:"14px"},children:new Date(h).toLocaleDateString()})}),e.jsx(v,{children:e.jsx(ae,{variant:"soft",color:x.color,children:x.label})}),e.jsxs(v,{align:"right",children:[e.jsx(_,{title:"Quick edit",placement:"top",arrow:!0,children:e.jsx(N,{color:b?"inherit":"default",onClick:()=>f(!0),children:e.jsx(E,{icon:"solar:pen-bold"})})}),e.jsx(_,{title:"Delete course",children:e.jsx(N,{onClick:g,children:e.jsx(E,{icon:"solar:trash-bin-trash-bold"})})})]})]}),e.jsx(ge,{currentCourse:t,open:b,onClose:()=>f(!1)})]})}function Le({filters:t,onFilters:c,locationOptions:s,onResetFilters:a,onDeleteRows:m,selected:j}){return e.jsx(I,{sx:{p:2.5},children:e.jsxs(q,{spacing:2.5,direction:{xs:"column",md:"row"},alignItems:{xs:"flex-end",md:"center"},children:[e.jsx(Q,{fullWidth:!0,value:t.name,onChange:d=>c("name",d.target.value),placeholder:"Search course...",InputProps:{startAdornment:e.jsx(le,{position:"start",children:e.jsx(E,{icon:"eva:search-fill",sx:{color:"text.disabled"}})})}}),e.jsxs(Q,{fullWidth:!0,select:!0,label:"Location",value:t.location,onChange:d=>c("location",d.target.value),InputLabelProps:{shrink:!0},children:[e.jsx(O,{value:"all",children:"All Locations"}),s.map(d=>e.jsx(O,{value:d,children:d},d))]}),e.jsxs(Q,{fullWidth:!0,select:!0,label:"Status",value:t.status,onChange:d=>c("status",d.target.value),InputLabelProps:{shrink:!0},children:[e.jsx(O,{value:"all",children:"All Status"}),e.jsx(O,{value:"upcoming",children:"Upcoming"}),e.jsx(O,{value:"ongoing",children:"Ongoing"}),e.jsx(O,{value:"completed",children:"Completed"})]}),e.jsxs(F,{color:"error",size:"small",onClick:m,startIcon:e.jsx(E,{icon:"solar:trash-bin-trash-bold"}),disabled:!j.length,children:["Delete (",j.length,")"]})]})})}function Oe({filters:t,onResetFilters:c,results:s,sx:a}){const m=o.useCallback(()=>{c()},[c]),j=o.useCallback(()=>{c()},[c]),d=o.useCallback(()=>{c()},[c]);return e.jsxs(me,{totalResults:s,onReset:c,sx:a,children:[e.jsx(B,{label:"Status:",isShow:t.status!=="all",children:e.jsx(M,{...V,label:t.status,onDelete:d,sx:{textTransform:"capitalize"}})}),e.jsx(B,{label:"Location:",isShow:t.location!=="all",children:e.jsx(M,{...V,label:t.location,onDelete:j})}),e.jsx(B,{label:"Keyword:",isShow:!!t.name,children:e.jsx(M,{...V,label:t.name,onDelete:m})})]})}const G={title:`Courses | Dashboard - ${K.appName}`};function Pe(){const t=ie(),{authenticated:c}=ce(),s=Ce(),[a,m]=o.useState([]),[j,d]=o.useState(!0),[l,u]=o.useState({name:"",location:"all",status:"all"}),[b,f]=o.useState(!1),[T,w]=o.useState(!1),[L,y]=o.useState(null),h=Ne({inputData:a,comparator:Ie(s.order,s.orderBy),filters:l}),g=l.name!==""||l.location!=="all"||l.status!=="all",i=!h.length&&g||!h.length,x=o.useCallback((n,p)=>{s.onResetPage(),u(W=>({...W,[n]:p}))},[s]),D=o.useCallback(()=>{s.onResetPage(),u({name:"",location:"",status:"all"})},[s]),S=o.useCallback(()=>{f(!0)},[]),R=o.useCallback(()=>{f(!1)},[]),Y=o.useCallback(n=>{y(n),w(!0)},[]),J=o.useCallback(()=>{y(null),w(!1)},[]),X=o.useCallback(async n=>{try{await A.delete(k.courses.details(n));const p=a.filter(W=>W.COURSEID!==n);m(p),s.onUpdatePageDeleteRow(h.length),U.success("Delete success!")}catch(p){console.error("Error deleting course:",p),U.error("Delete failed!")}},[a,h.length,s]),Z=o.useCallback(async()=>{try{const n=a.filter(p=>!s.selected.includes(p.COURSEID));for(const p of s.selected)await A.delete(k.courses.details(p));m(n),s.onUpdatePageDeleteRows(h.length,h.length),R(),U.success("Delete success!")}catch(n){console.error("Error deleting courses:",n),U.error("Delete failed!")}},[a,h.length,s,R]),ee=o.useCallback(n=>{t.push(P.dashboard.courses+`/${n}/edit`)},[t]),se=o.useCallback(n=>{t.push(P.dashboard.courses+`/${n}`)},[t]),H=o.useCallback(async()=>{try{d(!0);const n=await A.get(k.courses.list);m(n.data.courses||[])}catch(n){console.error("Error fetching courses:",n)}finally{d(!1)}},[]);return o.useEffect(()=>{c&&H()},[c,H]),c?j?e.jsxs(e.Fragment,{children:[e.jsx("title",{children:G.title}),e.jsx($,{maxWidth:"xl",children:e.jsx("div",{children:"Loading courses..."})})]}):e.jsxs(e.Fragment,{children:[e.jsx("title",{children:G.title}),e.jsxs($,{maxWidth:"xl",children:[e.jsx(be,{heading:"Courses List",links:[{name:"Dashboard",href:P.dashboard.root},{name:"Courses",href:P.dashboard.courses},{name:"List"}],action:e.jsx(F,{component:de,href:P.dashboard.course.new,variant:"contained",startIcon:e.jsx(E,{icon:"mingcute:add-line"}),children:"New Course"}),sx:{mb:{xs:3,md:5}}}),e.jsxs(I,{children:[e.jsx(Le,{filters:l,onFilters:x,locationOptions:[...new Set(a.map(n=>n.LOCATION))],onResetFilters:D,onDeleteRows:S,selected:s.selected}),g&&e.jsx(Oe,{filters:l,onResetFilters:D,results:h.length,sx:{p:2.5,pt:0}}),e.jsxs(z,{sx:{position:"relative"},children:[e.jsx(fe,{dense:s.dense,numSelected:s.selected.length,rowCount:h.length,onSelectAllRows:n=>s.onSelectAllRows(n,h.map(p=>p.COURSEID)),action:e.jsx(N,{color:"primary",onClick:S,children:e.jsx(E,{icon:"solar:trash-bin-trash-bold"})})}),e.jsx(he,{children:e.jsxs(De,{size:s.dense?"small":"medium",sx:{minWidth:960},children:[e.jsx(ye,{order:s.order,orderBy:s.orderBy,headCells:Ue,rowCount:h.length,numSelected:s.selected.length,onSort:s.onSort,onSelectAllRows:n=>s.onSelectAllRows(n,h.map(p=>p.COURSEID))}),e.jsxs(Se,{children:[h.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(n=>e.jsx(ke,{row:n,selected:s.selected.includes(n.COURSEID),onSelectRow:()=>s.onSelectRow(n.COURSEID),onDeleteRow:()=>X(n.COURSEID),onEditRow:()=>ee(n.COURSEID),onViewRow:()=>se(n.COURSEID),onViewDetails:Y,onQuickEdit:()=>{},editHref:P.dashboard.courses},n.COURSEID)),e.jsx(Ee,{height:s.dense?56:76,emptyRows:Te(s.page,s.rowsPerPage,h.length)}),e.jsx(we,{notFound:i})]})]})})]}),e.jsx(Re,{page:s.page,dense:s.dense,count:h.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,onChangeDense:s.onChangeDense,onRowsPerPageChange:s.onChangeRowsPerPage})]})]}),e.jsx(ve,{open:b,onClose:R,title:"Delete",content:e.jsxs(e.Fragment,{children:["Are you sure want to delete ",e.jsx("strong",{children:s.selected.length})," items?"]}),action:e.jsx(F,{variant:"contained",color:"error",onClick:Z,children:"Delete"})}),e.jsx(Ae,{open:T,onClose:J,courseId:L})]}):(t.push("/login"),null)}function Ne({inputData:t,comparator:c,filters:s}){const{name:a,location:m,status:j}=s,d=t.map((l,u)=>[l,u]);if(d.sort((l,u)=>{const b=c(l[0],u[0]);return b!==0?b:l[1]-u[1]}),t=d.map(l=>l[0]),a&&(t=t.filter(l=>l.TITLE.toLowerCase().indexOf(a.toLowerCase())!==-1)),m!=="all"&&(t=t.filter(l=>l.LOCATION===m)),j!=="all"){const l=new Date;t=t.filter(u=>{const b=new Date(u.STARTDATE),f=new Date(u.ENDDATE);return j==="upcoming"?b>l:j==="ongoing"?b<=l&&f>=l:j==="completed"?f<l:!0})}return t}const Ue=[{id:"TITLE",label:"Course Title"},{id:"LOCATION",label:"Location"},{id:"STARTDATE",label:"Start Date"},{id:"ENDDATE",label:"End Date"},{id:"STATUS",label:"Status"},{id:"",width:88}],ze={title:`Courses | Dashboard - ${K.appName}`};function $e(){return e.jsxs(e.Fragment,{children:[e.jsx("title",{children:ze.title}),e.jsx(Pe,{})]})}export{$e as default};
